<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ì˜¤ëŠ˜ì˜ì„ íƒ Â· ë½ìŠ¤íƒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì†Œë…€ (í”„ë¡œí† íƒ€ì…)</title>
  <style>
    :root{
      --safe-top: env(safe-area-inset-top);
      --safe-bot: env(safe-area-inset-bottom);

      --text: #f2f4ff;
      --muted: rgba(242,244,255,.72);
      --glass: rgba(10,12,18,.55);
      --glass2: rgba(10,12,18,.35);
      --line: rgba(255,255,255,.12);
      --accent: rgba(255,70,100,.9);

      --panel-radius: 22px;

      /* ìºë¦­í„° í•©ì„± ìŠ¤ì¼€ì¼ (ê¸°ë³¸ê°’) */
      --char-scale: 1;
      /* ìºë¦­í„° ê¸°ì¤€ ìœ„ì¹˜(í™”ë©´ í•˜ë‹¨ ìª½) */
      --char-x: 50%;
      --char-y: 47%;
    }

    html, body { height: 100%; }
    body{
      margin:0;
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      overflow: hidden;
      background: #000;
      -webkit-tap-highlight-color: transparent;
    }

    /* ===== í’€ìŠ¤í¬ë¦° ë°°ê²½ ===== */
    .bg{
      position: fixed;
      inset: 0;
      background:
        radial-gradient(1200px 800px at 50% 35%, rgba(255,255,255,.10), rgba(0,0,0,.75)),
        url("assets/bg/stage_vertical.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      filter: saturate(1.05) contrast(1.02);
      transform: translateZ(0);
    }
    .bg::after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(180deg,
        rgba(0,0,0,.20) 0%,
        rgba(0,0,0,.38) 40%,
        rgba(0,0,0,.72) 100%);
      pointer-events:none;
    }

    /* ===== ìƒë‹¨ HUD ===== */
    .hudTop{
      position: fixed;
      left: 0; right: 0;
      top: 0;
      padding: calc(12px + var(--safe-top)) 14px 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      z-index: 50;
      pointer-events: none; /* ì•„ë˜ í´ë¦­ ë°©ì§€ */
    }
    .titleBox{
      pointer-events:auto;
      display:flex;
      flex-direction:column;
      gap: 4px;
      max-width: 72%;
    }
    .title{
      font-weight: 950;
      letter-spacing: -.2px;
      font-size: 18px;
      display:flex;
      align-items:center;
      gap: 8px;
      text-shadow: 0 8px 22px rgba(0,0,0,.55);
    }
    .subtitle{
      font-size: 12px;
      color: var(--muted);
      text-shadow: 0 8px 22px rgba(0,0,0,.55);
    }
    .pill{
      pointer-events:auto;
      font-size: 12px;
      color: rgba(242,244,255,.88);
      border: 1px solid rgba(255,255,255,.15);
      background: rgba(0,0,0,.30);
      border-radius: 999px;
      padding: 8px 10px;
      white-space: nowrap;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }

    /* ===== ìºë¦­í„° ìŠ¤í…Œì´ì§€(í•©ì„±) ===== */
    .stage{
      position: fixed;
      inset: 0;
      z-index: 10;
      pointer-events: none;
    }

    .char{
      position:absolute;
      left: var(--char-x);
      top: var(--char-y);
      transform: translate(-50%, -50%) scale(var(--char-scale));
      transform-origin: 50% 50%;
      width: min(92vw, 520px);
      height: auto;
    }

    /* ê° ë ˆì´ì–´ëŠ” ê°™ì€ ì»¨í…Œì´ë„ˆ ê¸°ì¤€ìœ¼ë¡œ absolute */
    .layer{
      position:absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      transform-origin: 50% 50%;
      width: 100%;
      height: auto;
      image-rendering: auto;
      filter: drop-shadow(0 18px 24px rgba(0,0,0,.35));
    }

    /* ë ˆì´ì–´ë³„ z-index */
    #bodyLayer { z-index: 1; }
    #guitarLayer { z-index: 2; }
    #fretArmLayer { z-index: 3; }
    #pickArmLayer { z-index: 4; }

    /* ===== ëª¨ì…˜ ===== */
    @keyframes breathe {
      0%,100% { transform: translate(-50%,-50%) translateY(0px); }
      50% { transform: translate(-50%,-50%) translateY(-3px); }
    }
    .is-idle { animation: breathe 2.6s ease-in-out infinite; }

    /* í”„ë › ì†(ì™¼ì†) ë¯¸ì„¸í•œ í¬ì§€ì…˜ í”ë“¤ë¦¼ */
    @keyframes fretMove {
      0%,100% { transform: translate(-50%,-50%) rotate(0deg) translateX(0px); }
      50% { transform: translate(-50%,-50%) rotate(-1.2deg) translateX(2px); }
    }
    .is-fret { animation: fretMove 0.9s ease-in-out infinite; }

    /* í”¼í‚¹ ì†(ì˜¤ë¥¸ì†) ìŠ¤íŠ¸ëŸ­ ëŠë‚Œ: ìœ„/ì•„ë˜ */
    @keyframes pickStrum {
      0%   { transform: translate(-50%,-50%) rotate(6deg) translateY(-4px); }
      50%  { transform: translate(-50%,-50%) rotate(-10deg) translateY(6px); }
      100% { transform: translate(-50%,-50%) rotate(6deg) translateY(-4px); }
    }
    .is-pick { animation: pickStrum 0.24s ease-in-out infinite; }

    /* ì„ íƒ ëˆ„ë¥´ë©´ ì ê¹ â€˜í‘â€™ */
    @keyframes pop {
      0% { transform: translate(-50%,-50%) scale(1); }
      45%{ transform: translate(-50%,-50%) scale(1.03); }
      100%{ transform: translate(-50%,-50%) scale(1); }
    }
    .is-pop { animation: pop .22s ease-out 1; }

    /* ===== í•˜ë‹¨ UI íŒ¨ë„ ===== */
    .panel{
      position: fixed;
      left: 10px; right: 10px;
      bottom: calc(10px + var(--safe-bot));
      z-index: 80;
      border-radius: var(--panel-radius);
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.30);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: 0 22px 60px rgba(0,0,0,.55);
      overflow: hidden;
    }

    .panelInner{
      padding: 12px 12px 12px;
    }

    .topRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
      color: var(--muted);
      font-size: 12px;
    }

    .prog{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 140px;
    }
    .bar{
      flex:1;
      height: 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.12);
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width: 0%;
      background: rgba(255,255,255,.72);
    }

    .q{
      font-weight: 950;
      letter-spacing: -.2px;
      font-size: 18px;
      margin: 2px 0 6px;
    }
    .d{
      margin: 0 0 10px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    .choices{
      display:grid;
      gap: 10px;
    }
    .choice{
      text-align:left;
      padding: 14px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.15);
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-size: 16px;
      cursor: pointer;
    }
    .choice:active{ transform: translateY(1px); }

    .btnRow{
      margin-top: 10px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .btn{
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      color: rgba(242,244,255,.90);
      font-size: 13px;
      cursor:pointer;
    }

    /* ===== ë¡œê·¸ ===== */
    .log{
      display:none;
      border-top: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.25);
      max-height: 34vh;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      padding: 10px 12px;
    }
    .log h3{
      margin:0 0 8px 0;
      font-size: 13px;
      color: rgba(242,244,255,.85);
    }
    .item{
      border-top: 1px solid rgba(255,255,255,.10);
      padding: 8px 0;
      font-size: 13px;
    }
    .t{ color: rgba(242,244,255,.65); font-size: 12px; }
    .qq{ color: rgba(242,244,255,.70); font-size: 12px; margin-top: 3px; }

    /* ===== ì‹œì‘(ìºë¦­í„° ìƒì„±) ===== */
    .start{
      position: fixed;
      inset: 0;
      z-index: 999;
      display:none;
    }
    .start .dim{
      position:absolute;
      inset:0;
      background: rgba(0,0,0,.72);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    .start .box{
      position:relative;
      height: 100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: calc(18px + var(--safe-top)) 14px calc(18px + var(--safe-bot));
      box-sizing: border-box;
    }
    .start .card{
      width: 100%;
      max-width: 520px;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(10,12,18,.92);
      box-shadow: 0 24px 70px rgba(0,0,0,.55);
      padding: 16px;
    }
    .start .card .h{
      font-weight: 950;
      font-size: 18px;
      margin-bottom: 6px;
      display:flex;
      align-items:center;
      gap: 8px;
    }
    .dot{
      width: 10px; height: 10px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 22px rgba(255,70,100,.55);
      display:inline-block;
    }
    .start .card .p{
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
      margin: 0 0 12px;
    }
    .field{ margin: 10px 0; }
    label{
      display:block;
      font-size: 12px;
      color: rgba(242,244,255,.70);
      margin-bottom: 6px;
    }
    input, select{
      width:100%;
      box-sizing:border-box;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-size: 15px;
      outline:none;
    }
    .startBtns{
      display:flex;
      gap: 10px;
      margin-top: 12px;
    }
    .primary{
      flex:1;
      padding: 13px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,70,100,.18);
      color: var(--text);
      font-weight: 900;
      font-size: 15px;
      cursor:pointer;
    }
    .secondary{
      padding: 13px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: transparent;
      color: rgba(242,244,255,.85);
      font-weight: 850;
      font-size: 15px;
      cursor:pointer;
      white-space: nowrap;
    }
  </style>
</head>

<body>
  <div class="bg" aria-hidden="true"></div>

  <div class="hudTop">
    <div class="titleBox">
      <div class="title">ğŸ¸ ì˜¤ëŠ˜ì˜ì„ íƒ Â· ë½ìŠ¤íƒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì†Œë…€</div>
      <div class="subtitle">í”„ë¡œí† íƒ€ì… Â· ì„ íƒì´ ëˆ„ì ë˜ëŠ” ê²Œì„</div>
    </div>
    <div class="pill" id="userPill">ë¡œë”©ì¤‘â€¦</div>
  </div>

  <!-- ìºë¦­í„° í•©ì„± -->
  <div class="stage" aria-hidden="true">
    <div class="char">
      <img id="bodyLayer" class="layer is-idle" src="assets/character/rockstar_body.png" alt="">
      <img id="guitarLayer" class="layer" src="assets/character/rockstar_guitar.png" alt="">
      <img id="fretArmLayer" class="layer is-fret" src="assets/character/rockstar_fret_arm.png" alt="">
      <img id="pickArmLayer" class="layer is-pick" src="assets/character/rockstar_pick_arm.png" alt="">
    </div>
  </div>

  <!-- í•˜ë‹¨ ì§ˆë¬¸ íŒ¨ë„ -->
  <div class="panel">
    <div class="panelInner">
      <div class="topRow">
        <div class="prog">
          <span id="qIdx">Q 1/15</span>
          <div class="bar"><div id="barFill"></div></div>
        </div>
        <div id="hint">ì„ íƒí•˜ë©´ ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.</div>
      </div>

      <div class="q" id="qText">ë¡œë”©ì¤‘â€¦</div>
      <div class="d" id="qDesc"></div>

      <div class="choices" id="choices"></div>

      <div class="btnRow">
        <button class="btn" id="btnLog">ë‚´ ê¸°ë¡</button>
        <button class="btn" id="btnRestart">ì§„í–‰ ì´ˆê¸°í™”</button>
        <button class="btn" id="btnWipe">ì „ë¶€ ì‚­ì œ</button>
      </div>
    </div>

    <div class="log" id="logPanel">
      <h3>ë‚´ ê¸°ë¡ (ì´ ê¸°ê¸°ì—ë§Œ ì €ì¥)</h3>
      <div id="logBody"></div>
    </div>
  </div>

  <!-- ì‹œì‘ í™”ë©´ -->
  <div class="start" id="start">
    <div class="dim"></div>
    <div class="box">
      <div class="card">
        <div class="h">ğŸ¸ ìºë¦­í„° ìƒì„± <span class="dot"></span></div>
        <p class="p">
          ë‹‰ë„¤ì„/ë‚˜ì´/ì„±ë³„ì„ ì •í•˜ë©´ ì‹œì‘í•©ë‹ˆë‹¤.<br>
          ì„œë²„ ì „ì†¡ ì—†ìŒ(ë¡œì»¬ ì €ì¥).
        </p>

        <div class="field">
          <label for="nick">ë‹‰ë„¤ì„</label>
          <input id="nick" maxlength="12" />
        </div>

        <div class="field">
          <label for="age">ë‚˜ì´</label>
          <select id="age">
            <option value="">ì„ íƒ</option>
            <option>10ëŒ€</option><option>20ëŒ€</option><option>30ëŒ€</option><option>40ëŒ€</option><option>50ëŒ€+</option>
          </select>
        </div>

        <div class="field">
          <label for="gender">ì„±ë³„</label>
          <select id="gender">
            <option value="">ì„ íƒ</option>
            <option value="ë‚¨">ë‚¨</option>
            <option value="ì—¬">ì—¬</option>
            <option value="ê¸°íƒ€">ê¸°íƒ€/ë¹„ê³µê°œ</option>
          </select>
        </div>

        <div class="startBtns">
          <button class="primary" id="btnStart">ì‹œì‘í•˜ê¸°</button>
          <button class="secondary" id="btnDemo">ë°ëª¨</button>
        </div>
      </div>
    </div>
  </div>

<script>
  // ===== ë¡œì»¬ ì €ì¥ í‚¤ =====
  const LS_PROFILE = "rs_profile_v2";
  const LS_RUN     = "rs_run_v2";
  const LS_LOG     = "rs_log_v2";

  // ===== 15 ë¬¸í•­(ì¡°ê¸ˆ ë” â€˜ì „ë¬¸ì â€™ì´ê³  ì¬ë°Œê²Œ) =====
  const QUESTIONS = [
    { q:"ì˜¤ëŠ˜ ì—°ìŠµ, â€˜ìµœì†Œ ìœ íš¨ ë¶„ëŸ‰â€™ì€?", d:"ë½ìŠ¤íƒ€ëŠ” ì»¨ë””ì…˜ì´ ì•„ë‹ˆë¼ ìµœì†Œì¹˜ë¥¼ ì§€í‚¨ë‹¤.", o:["10ë¶„ ë£¨í‹´ë§Œ ë”±(ë©”íŠ¸ë¡œë†ˆ í¬í•¨)","30ë¶„(ì†+ê·€ í›ˆë ¨ ë¶„ë¦¬)","60ë¶„(ê³¡/ê¸°ìˆ /ë¦¬ë“¬ 3ë¶„í• )","ì˜¤ëŠ˜ì€ íœ´ì‹(ëŒ€ì‹  ê·€í›ˆë ¨/ì²­ìŒ)"] },
    { q:"í”¼í‚¹ì´ í”ë“¤ë¦´ ë•Œ, ì œì¼ ë¨¼ì €?", d:"ì†ëª© í˜ì´ ì•„ë‹ˆë¼ â€˜ë¦¬ë“¬ ê¸°ì¤€â€™ë¶€í„° ì¡ëŠ”ë‹¤.", o:["ë‹¤ìš´í”¼í‚¹ë§Œìœ¼ë¡œ ë°•ì ê³ ì •","ë©”íŠ¸ë¡œë†ˆ 2&4ì—ë§Œ ë‘ê³  ì—°ìŠµ","ìŠ¤íŠ¸ë¡œí¬ ê°ë„/í”¼í¬ ë…¸ì¶œëŸ‰ ì¡°ì •","ê²Œì¸ ì˜¬ë ¤ì„œ ëŒ€ì¶© ë°€ì–´ë²„ë¦¼"] },
    { q:"í”„ë › ì¡ì„ ë•Œ ì¡ìŒì´ ë‚œë‹¤. ìš°ì„ ìˆœìœ„ëŠ”?", d:"ì¡ìŒì€ ì†ê°€ë½ì´ ì•„ë‹ˆë¼ â€˜ë®¤íŠ¸ ì„¤ê³„â€™ ë¬¸ì œë‹¤.", o:["ì–‘ì† ë®¤íŠ¸(ì—„ì§€/ì†ë‚ ) ì²´í¬","í”„ë › ë°”ë¡œ ë’¤ í¬ì§€ì…˜ë¶€í„°","ê²Œì¸/ì»´í”„ë¥¼ ë‚®ì¶° ì›ì¸ ë“œëŸ¬ë‚´ê¸°","EQë¥¼ ê¹ì•„ì„œ ìˆ¨ê¸°ê¸°"] },
    { q:"ë¦¬ë“¬ì´ ë°€ë¦°ë‹¤. í•´ê²° ë£¨í‹´ì€?", d:"ë°•ìëŠ” â€˜ëª¸â€™ì´ ë¨¼ì € ì•Œê³ , ì†ì´ ë”°ë¼ì˜¨ë‹¤.", o:["ë°œë¡œ 8ë¹„íŠ¸ ìŠ¤í… ê³ ì • + ì—°ì£¼","í´ë¦­ì„ ë°˜ìœ¼ë¡œ ëŠë¦¬ê²Œ ì²´ê°","ë¦¬í”„ë¥¼ 2ë§ˆë”” ë£¨í”„ë¡œ ìª¼ê°œê¸°","ê·¸ëƒ¥ ê³„ì† ì¹˜ë‹¤ ë³´ë©´ ë§ìŒ"] },
    { q:"í†¤ì´ ë§ˆìŒì— ì•ˆ ë“¤ ë•Œ, ì²« ì ê²€ì€?", d:"ì¥ë¹„ë³´ë‹¤ â€˜ì‹ í˜¸ íë¦„â€™ì´ ë¨¼ì €ë‹¤.", o:["ë³¼ë¥¨/í†¤/í”½ì—… í¬ì§€ì…˜ë¶€í„°","ì•°í”„ EQë¥¼ ê·¹ë‹¨ìœ¼ë¡œ ëŒë ¤ ê¸°ì¤€ ì°¾ê¸°","ì¼€ì´ë¸”/ë…¸ì´ì¦ˆ/ì ‘ì´‰ë¶€í„° í™•ì¸","IR/í”„ë¦¬ì…‹ì„ ìƒˆë¡œ ê°ˆì•„ì—ê¸°"] },
    { q:"í•©ì£¼ì—ì„œ ê¸°íƒ€ê°€ ë¬»íŒë‹¤. ë„ˆì˜ ì„ íƒì€?", d:"ë” í¬ê²Œê°€ ì•„ë‹ˆë¼ â€˜ê³µê°„ ë°°ì¹˜â€™ë‹¤.", o:["ë¯¸ë“¤ ì˜¬ë¦¬ê³  ë² ì´ìŠ¤ ì£¼íŒŒìˆ˜ ë¹„ìš°ê¸°","ê²Œì¸ ì¤„ì´ê³  ì–´íƒ ì˜¬ë¦¬ê¸°","ë³¼ë¥¨ë§Œ ì˜¬ë ¤ì„œ ìŠ¹ë¶€","ì½”ëŸ¬ìŠ¤/ë¦¬ë²„ë¸Œ ë” ì–¹ê¸°"] },
    { q:"ë…¹ìŒí•´ë³´ë‹ˆ ë°•ìê°€ ë“¤ì‘¥ë‚ ì‘¥. ë„ˆëŠ”?", d:"ë…¹ìŒì€ ê±°ì§“ë§ì„ ì•ˆ í•œë‹¤.", o:["í´ë¦­/ë“œëŸ¼ ë£¨í”„ì— ë§ì¶° ì¬ë…¹ìŒ","ë¬¸ì œ êµ¬ê°„ë§Œ í€ì¹˜ì¸","ê·¸ëƒ¥ ê°ì„±ì´ë¼ ìš°ê¸°ê¸°","í…œí¬ë§µ/í€€íƒ€ì´ì¦ˆë¡œ ë°€ì–´ë„£ê¸°"] },
    { q:"ê¸°íƒ€ì¤„/ì…‹ì—… ì£¼ê¸°, í˜„ì‹¤ì ì¸ ê¸°ì¤€ì€?", d:"ì—°ì£¼ê°ì€ ì‹¤ë ¥ì˜ ì¦í­ê¸°ë‹¤.", o:["ìì£¼ ì—°ì£¼í•˜ë©´ 2~4ì£¼","í•œ ë‹¬~ë‘ ë‹¬ (ìƒíƒœ ë´„)","ëŠì–´ì§ˆ ë•Œê¹Œì§€","ê¸°ì–µë‚  ë•Œ í•œ ë²ˆ"] },
    { q:"ì½”ë“œê°€ â€˜íƒâ€™ ë‹«íˆì§€ ì•ŠëŠ”ë‹¤. ì²« êµì •ì€?", d:"ë³´ì´ì‹±ì´ ì•„ë‹ˆë¼ â€˜ì†ì˜ ì••ë ¥ ë¶„ë°°â€™ë‹¤.", o:["í•„ìš”í•œ ì¤„ë§Œ ëˆ„ë¥´ê³  ë‚˜ë¨¸ì§€ ë®¤íŠ¸","ê·¸ë¦½ ì„¸ê²Œ(ì•…ë ¥ìœ¼ë¡œ í•´ê²°)","ì†ê°€ë½ ê°ë„(ì†í†± ë°©í–¥) ì¡°ì •","í¬ê¸°í•˜ê³  íŒŒì›Œì½”ë“œ"] },
    { q:"ì†”ë¡œê°€ ë°‹ë°‹í•˜ë‹¤. ê°€ì¥ íš¨ê³¼ í° ê±´?", d:"ì†ë„ë³´ë‹¤ â€˜í”„ë ˆì´ì§• ë¬¸ì¥â€™ì´ ë¨¼ì €ë‹¤.", o:["íƒ€ê²Ÿ ë…¸íŠ¸(ì½”ë“œí†¤) ì˜ì‹","ë²¤ë”© í”¼ì¹˜ ì •í™•ë„ë¶€í„°","ìŠ¤ì¼€ì¼ íŒ¨í„´ì„ 2ë°° ì†ë„ë¡œ","ë ˆì´í¬/ìŠ¤ìœ•ìœ¼ë¡œ í™”ë ¤í•˜ê²Œ"] },
    { q:"ë¬´ëŒ€(ì‚¬ëŒ ì•) ê¸´ì¥. ëŒ€ì²˜ëŠ”?", d:"ê¸´ì¥ì€ ì‚¬ë¼ì§€ëŠ” ê²Œ ì•„ë‹ˆë¼ ê¸¸ë“¤ì¸ë‹¤.", o:["ì‘ê²Œë¼ë„ ìì£¼ â€˜ë…¸ì¶œâ€™í•œë‹¤","ì™„ë²½í•´ì§ˆ ë•Œê¹Œì§€ ìˆ¨ëŠ”ë‹¤","ì¹œêµ¬ 1ëª… ì•ì—ì„œë§Œ","ë‚œ ë¬´ëŒ€ ì²´ì§ˆì´ ì•„ë‹˜"] },
    { q:"ì‘ê³¡ ì‹œì‘. ì²« ë‹¨ì¶”ëŠ”?", d:"ì¢‹ì€ ê³¡ì€ â€˜ì œì•½â€™ì—ì„œ ë‚˜ì˜¨ë‹¤.", o:["ë“œëŸ¼/í…œí¬ ë¨¼ì € ê³ ì •","ë¦¬í”„ í•œ ì¤„ë¡œ ì‹œì‘","ê°€ì‚¬/ìŠ¤í† ë¦¬ ë¨¼ì €","ë ˆí¼ëŸ°ìŠ¤ ë¶„ì„ í›„ êµ¬ì¡° ì„¤ê³„"] },
    { q:"ì—°ìŠµì´ ì•ˆ í’€ë¦´ ë•Œ â€˜íšŒë³µâ€™ ë°©ë²•ì€?", d:"ë§ê°€ì§„ ì†ì€ ë” ë°€ë©´ ë” ë§ê°€ì§„ë‹¤.", o:["í…œí¬ ë‚®ì¶”ê³  ì •í™•ë„ë¡œ ë¦¬ì…‹","ê·€í›ˆë ¨(ë¦¬ë“¬ ì¹´ìš´íŠ¸)ìœ¼ë¡œ ì „í™˜","ë‹¤ë¥¸ ê³¡ìœ¼ë¡œ ë„ë§","ì¥ë¹„ ì‡¼í•‘/ë¦¬ë·°ë¡œ ë„íŒŒë¯¼"] },
    { q:"ì˜¤ëŠ˜ì˜ â€˜í”„ë¡œâ€™ ê°™ì€ ì„ íƒì€?", d:"í”„ë¡œëŠ” ê°ì •ì´ ì•„ë‹ˆë¼ ì‹œìŠ¤í…œìœ¼ë¡œ ì›€ì§ì¸ë‹¤.", o:["ì—°ìŠµ ì‹œê°„ì„ ìº˜ë¦°ë”ì— ë°•ì œ","ê¸°ë¡(ì§§ì€ ì˜ìƒ) ë‚¨ê¸°ê¸°","ë‚´ì¼ í•  ê²ƒë§Œ ì ê³  ì¢…ë£Œ","ì•„ë¬´ê²ƒë„ ì•ˆ í–ˆì§€ë§Œ ë§ˆìŒì€ í”„ë¡œ"] },
    { q:"ë§ˆì§€ë§‰. ì˜¤ëŠ˜ ë„ˆëŠ” ë½ìŠ¤íƒ€ì— ê°€ê¹Œì› ë‚˜?", d:"ë‹µì€ ì´ë¯¸ ì•Œê³  ìˆë‹¤. ê¸°ë¡í•´ë¼.", o:["ê°€ê¹Œì› ë‹¤. í–‰ë™í–ˆë‹¤.","ë°˜ë°˜. ì¡°ê¸ˆì€ í–ˆë‹¤.","ë©€ì—ˆë‹¤. í•˜ì§€ë§Œ ë‚´ì¼ ë°”ê¾¼ë‹¤.","ëª¨ë¥´ê² ì§€ë§Œ ê¸°íƒ€ëŠ” ë†“ì§€ ì•ŠëŠ”ë‹¤."] },
  ];

  // ===== DOM =====
  const start = document.getElementById("start");
  const nickEl = document.getElementById("nick");
  const ageEl = document.getElementById("age");
  const genderEl = document.getElementById("gender");
  const btnStart = document.getElementById("btnStart");
  const btnDemo = document.getElementById("btnDemo");

  const userPill = document.getElementById("userPill");
  const qIdx = document.getElementById("qIdx");
  const barFill = document.getElementById("barFill");
  const qText = document.getElementById("qText");
  const qDesc = document.getElementById("qDesc");
  const choices = document.getElementById("choices");
  const hint = document.getElementById("hint");

  const btnLog = document.getElementById("btnLog");
  const btnRestart = document.getElementById("btnRestart");
  const btnWipe = document.getElementById("btnWipe");
  const logPanel = document.getElementById("logPanel");
  const logBody = document.getElementById("logBody");

  const bodyLayer = document.getElementById("bodyLayer");
  const fretArmLayer = document.getElementById("fretArmLayer");
  const pickArmLayer = document.getElementById("pickArmLayer");

  // ===== ìœ í‹¸ =====
  const loadJSON = (k, fb) => { try { return JSON.parse(localStorage.getItem(k)); } catch { return fb; } };
  const saveJSON = (k, v) => localStorage.setItem(k, JSON.stringify(v));
  const nowKST = () => new Date().toLocaleString("ko-KR");
  const esc = (s) => String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");

  function showStart(){ start.style.display = "block"; }
  function hideStart(){ start.style.display = "none"; }

  function applyProfile(p){
    const nick = p?.nick || "í”Œë ˆì´ì–´";
    const age = p?.age || "";
    const gender = p?.gender || "";
    userPill.textContent = `${nick}${age ? " Â· "+age : ""}${gender ? " Â· "+gender : ""}`;
  }

  function initRun(){
    const run = { idx: 0, answers: [] };
    saveJSON(LS_RUN, run);
    return run;
  }

  function addLog(entry){
    const logs = loadJSON(LS_LOG, []) || [];
    logs.unshift(entry);
    saveJSON(LS_LOG, logs);
  }

  function renderLog(){
    const logs = loadJSON(LS_LOG, []) || [];
    if (!logs.length){
      logBody.innerHTML = `<div class="item"><div class="t">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div></div>`;
      return;
    }
    logBody.innerHTML = logs.slice(0, 60).map(l => `
      <div class="item">
        <div class="t">[${esc(l.time)}]</div>
        <div><b>${esc(l.answer)}</b></div>
        <div class="qq">${esc(l.question)}</div>
      </div>
    `).join("");
  }

  function popCharacter(){
    bodyLayer.classList.remove("is-pop");
    fretArmLayer.classList.remove("is-pop");
    pickArmLayer.classList.remove("is-pop");
    void bodyLayer.offsetWidth;
    bodyLayer.classList.add("is-pop");
    fretArmLayer.classList.add("is-pop");
    pickArmLayer.classList.add("is-pop");
  }

  function renderQuestion(run){
    const total = QUESTIONS.length;
    const idx = run.idx;

    if (idx >= total){
      qIdx.textContent = `END Â· ${total}/${total}`;
      barFill.style.width = `100%`;
      qText.textContent = "ì˜¤ëŠ˜ì˜ ì„ íƒì´ ì €ì¥ëë‹¤.";
      qDesc.textContent = "ëì´ ì•„ë‹ˆë¼ ëˆ„ì ì˜ ì‹œì‘ì´ë‹¤. ë‚´ì¼ ë˜ ì„ íƒí•˜ë©´ ë‹¤ìŒ ì¥ë©´ì´ ì—´ë¦°ë‹¤.";
      choices.innerHTML = `
        <button class="choice" id="btnAgain">ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°</button>
        <button class="choice" id="btnSeeLog">ë‚´ ê¸°ë¡ ë³´ê¸°/ë‹«ê¸°</button>
      `;
      document.getElementById("btnAgain").onclick = () => {
        if (confirm("ì§„í–‰(15ë¬¸í•­)ì„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ í• ê¹Œìš”? (ê¸°ë¡ ë¡œê·¸ëŠ” ìœ ì§€)")){
          const newRun = initRun();
          renderQuestion(newRun);
        }
      };
      document.getElementById("btnSeeLog").onclick = toggleLog;
      hint.textContent = "ì—”ë”©. ë‹¤ì‹œí•˜ê¸° ë˜ëŠ” ê¸°ë¡ í™•ì¸.";
      return;
    }

    const q = QUESTIONS[idx];
    qIdx.textContent = `Q ${idx+1}/${total}`;
    barFill.style.width = `${Math.round((idx / total) * 100)}%`;
    qText.textContent = q.q;
    qDesc.textContent = q.d;
    hint.textContent = "ì„ íƒí•˜ë©´ ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.";

    choices.innerHTML = "";
    q.o.forEach((opt, i) => {
      const b = document.createElement("button");
      b.className = "choice";
      b.textContent = `${["A","B","C","D"][i]}. ${opt}`;
      b.onclick = () => onChoose(run, q.q, opt);
      choices.appendChild(b);
    });
  }

  function onChoose(run, question, answer){
    popCharacter();

    run.answers.push({ question, answer, at: new Date().toISOString() });
    addLog({ time: nowKST(), question, answer });
    saveJSON(LS_RUN, run);

    renderLog();
    run.idx += 1;
    saveJSON(LS_RUN, run);

    hint.textContent = "ê¸°ë¡ ì™„ë£Œ. ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ì´ë™â€¦";
    setTimeout(() => renderQuestion(run), 260);
  }

  function toggleLog(){
    const open = getComputedStyle(logPanel).display !== "none";
    logPanel.style.display = open ? "none" : "block";
  }

  function restartRun(){
    if (!confirm("ì§„í–‰(15ë¬¸í•­)ì„ ì´ˆê¸°í™”í• ê¹Œìš”? (ê¸°ë¡ ë¡œê·¸ëŠ” ìœ ì§€)")) return;
    const run = initRun();
    renderQuestion(run);
  }

  function wipeAll(){
    if (!confirm("í”„ë¡œí•„/ì§„í–‰/ê¸°ë¡ì„ ì „ë¶€ ì‚­ì œí•˜ê³  ì²˜ìŒë¶€í„° ì‹œì‘í• ê¹Œìš”?")) return;
    localStorage.removeItem(LS_PROFILE);
    localStorage.removeItem(LS_RUN);
    localStorage.removeItem(LS_LOG);
    location.reload();
  }

  btnLog.addEventListener("click", toggleLog);
  btnRestart.addEventListener("click", restartRun);
  btnWipe.addEventListener("click", wipeAll);

  btnStart.addEventListener("click", () => {
    const nick = (nickEl.value || "").trim();
    const age = ageEl.value;
    const gender = genderEl.value;
    if (!nick || !age || !gender){
      alert("ë‹‰ë„¤ì„/ë‚˜ì´/ì„±ë³„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }
    saveJSON(LS_PROFILE, { nick, age, gender });
    hideStart();
    boot();
  });

  btnDemo.addEventListener("click", () => {
    saveJSON(LS_PROFILE, { nick:"ë°ëª¨", age:"20ëŒ€", gender:"ê¸°íƒ€/ë¹„ê³µê°œ" });
    hideStart();
    boot();
  });

  // ===== ë¶€íŒ… =====
  function boot(){
    const profile = loadJSON(LS_PROFILE, null);
    if (!profile){
      showStart();
      return;
    }
    applyProfile(profile);

    let run = loadJSON(LS_RUN, null);
    if (!run) run = initRun();

    renderLog();
    renderQuestion(run);
  }

  boot();
</script>
</body>
</html>
