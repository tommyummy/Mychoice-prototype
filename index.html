<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ì˜¤ëŠ˜ì˜ì„ íƒ Â· ë½ìŠ¤íƒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì†Œë…€ (í”„ë¡œí† íƒ€ì…)</title>
  <style>
    :root{
      --safe-top: env(safe-area-inset-top);
      --safe-bot: env(safe-area-inset-bottom);
      --bg: #0b0f1a;
      --panel: rgba(255,255,255,0.06);
      --panel2: rgba(0,0,0,0.35);
      --border: rgba(255,255,255,0.12);
      --text: #f0f2ff;
      --muted: rgba(240,242,255,0.70);
      --muted2: rgba(240,242,255,0.55);
      --accent: rgba(255,60,95,0.85);
    }

    /* ì „ì²´ í™”ë©´(ëª¨ë°”ì¼ ì•± ëŠë‚Œ) */
    html, body { height: 100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100svh;
      overflow: hidden;
    }

    .wrap{
      max-width: 520px;
      margin: 0 auto;
      height: 100svh;
      padding: calc(12px + var(--safe-top)) 12px calc(12px + var(--safe-bot));
      box-sizing: border-box;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .brand{
      font-weight: 900;
      letter-spacing: 0.2px;
      display:flex; align-items:center; gap:8px;
      font-size: 16px;
    }
    .pill{
      font-size:12px;
      padding:6px 10px;
      border:1px solid var(--border);
      border-radius: 999px;
      color: var(--muted);
      background: rgba(255,255,255,0.03);
      white-space: nowrap;
    }

    .stage{
      height: calc(100svh - (12px + var(--safe-top) + 12px + var(--safe-bot) + 34px)); /* ëŒ€ì¶© topbar í¬í•¨ */
      border: 1px solid var(--border);
      border-radius: 18px;
      overflow: hidden;
      background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.02));
      display:flex;
      flex-direction: column;
    }

    .characters{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
      padding: 12px;
      border-bottom: 1px solid var(--border);
      background: rgba(0,0,0,0.18);
    }
    .char{
      display:flex;
      gap: 12px;
      align-items:center;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.22);
      border-radius: 14px;
      padding: 10px;
    }
    .avatar{
      width: 88px;
      height: 88px;
      border-radius: 16px;
      background: rgba(255,255,255,0.06);
      display:grid;
      place-items:center;
      transform-origin: 50% 80%;
      will-change: transform, filter;
      overflow:hidden;
      position: relative;
    }

    /* âœ… í”Œë ˆì´ì–´ ì•„ë°”íƒ€(ì´ë¯¸ì§€) */
    .avatar img{
      width:100%;
      height:100%;
      object-fit: contain;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,0.35));
    }

    .meta .name{ font-weight: 900; }
    .meta .role{ font-size: 12px; color: var(--muted); margin-top:4px; }

    /* ê°„ë‹¨í•œ â€œë¹¨ê°„ í¬ì¸íŠ¸â€ */
    .accent-dot{
      width:10px; height:10px; border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 18px rgba(255,60,95,0.55);
      display:inline-block;
      margin-left: 6px;
      vertical-align: middle;
    }

    /* ëŒ€í™”/ì„ íƒ ì˜ì—­ */
    .dialogue{
      flex: 1;
      display:flex;
      flex-direction: column;
      gap: 10px;
      padding: 12px;
      background: var(--panel2);
      overflow: hidden;
    }
    .hud{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      font-size:12px;
      color: var(--muted);
    }
    .progress{
      display:flex;
      align-items:center;
      gap: 8px;
    }
    .bar{
      width: 120px;
      height: 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      overflow:hidden;
    }
    .bar > div{
      height: 100%;
      width: 0%;
      background: rgba(255,255,255,0.75);
    }

    .box{
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 14px;
      padding: 14px;
      background: rgba(255,255,255,0.05);
      box-shadow: 0 12px 30px rgba(0,0,0,0.25);
    }
    .question{
      margin:0 0 10px 0;
      font-size: 18px;
      font-weight: 900;
      letter-spacing: -0.2px;
    }
    .desc{
      margin: 0 0 12px 0;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.35;
    }

    .choices{
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      padding-bottom: 6px;
      display:grid;
      gap: 10px;
    }
    button.choice{
      text-align:left;
      padding: 14px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      font-size: 16px;
    }
    button.choice:active{ transform: translateY(1px); }

    .row{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
    }
    button.ghost{
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.14);
      background: transparent;
      color: rgba(240,242,255,0.85);
      font-size: 13px;
    }

    /* ë¡œê·¸ íŒ¨ë„(í† ê¸€) */
    .log{
      display:none;
      border-top: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      padding: 10px 12px;
      max-height: 38%;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }
    .log h3{
      margin: 0 0 8px 0;
      font-size: 13px;
      color: rgba(240,242,255,0.85);
    }
    .item{
      padding: 8px 0;
      border-top: 1px solid rgba(255,255,255,0.08);
      font-size: 13px;
      color: rgba(240,242,255,0.9);
    }
    .item .t{ color: var(--muted2); font-size: 12px; }
    .item .q{ color: var(--muted); font-size: 12px; margin-top: 3px; }

    /* ì‹œì‘ í™”ë©´(ìºë¦­í„° ìƒì„±) */
    #startScreen{
      position: fixed;
      inset: 0;
      z-index: 9999;
      display:none;
    }
    #startScreen .backdrop{
      position:absolute;
      inset:0;
      background: rgba(0,0,0,0.75);
    }
    #startScreen .panelWrap{
      position:relative;
      height: 100svh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: calc(18px + var(--safe-top)) 16px calc(18px + var(--safe-bot));
      box-sizing:border-box;
    }
    #startScreen .panel{
      width:100%;
      max-width: 520px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(10,14,25,0.94);
      padding: 18px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.45);
    }
    .title{
      font-weight: 950;
      font-size: 18px;
      margin-bottom: 6px;
      display:flex; align-items:center; gap:8px;
    }
    .subtitle{
      font-size: 13px;
      color: var(--muted);
      line-height: 1.35;
      margin-bottom: 14px;
    }
    .field{
      margin: 12px 0;
    }
    .field label{
      display:block;
      font-size: 12px;
      color: rgba(240,242,255,0.75);
      margin-bottom: 6px;
    }
    .field input, .field select{
      width:100%;
      box-sizing:border-box;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      font-size: 15px;
      outline: none;
    }
    .field input::placeholder{ color: rgba(240,242,255,0.45); }

    .startBtns{
      display:flex;
      gap: 10px;
      margin-top: 14px;
    }
    .primary{
      flex: 1;
      padding: 13px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,60,95,0.18);
      color: var(--text);
      font-weight: 900;
      font-size: 15px;
    }
    .secondary{
      padding: 13px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.14);
      background: transparent;
      color: rgba(240,242,255,0.85);
      font-weight: 800;
      font-size: 15px;
      white-space: nowrap;
    }
    .warn{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(240,242,255,0.62);
    }

    /* ===== ìºë¦­í„° ì›€ì§ì„(ìƒíƒœ) ===== */
    @keyframes idleBreath {
      0%, 100% { transform: translateY(0px) scale(1); }
      50%      { transform: translateY(-2px) scale(1.01); }
    }
    @keyframes talkNod {
      0%, 100% { transform: translateY(-1px) rotate(0deg) scale(1.01); }
      25%      { transform: translateY(-3px) rotate(-1deg) scale(1.015); }
      75%      { transform: translateY(-3px) rotate(1deg)  scale(1.015); }
    }
    @keyframes reactPop {
      0%   { transform: translateY(0px) scale(1); }
      40%  { transform: translateY(-4px) scale(1.05); }
      100% { transform: translateY(0px) scale(1.01); }
    }
    .is-idle { animation: idleBreath 2.8s ease-in-out infinite; }
    .is-talk { animation: talkNod 0.65s ease-in-out infinite; }
    .is-react { animation: reactPop 0.35s ease-out; }

    /* ë°ìŠ¤í¬íƒ‘ì—ì„œëŠ” ê¸°ì¡´ì²˜ëŸ¼ ë„“ê²Œ(ì„ íƒì‚¬í•­) */
    @media (min-width: 900px){
      body{ overflow:auto; height:auto; }
      .wrap{ max-width: 860px; height:auto; padding: 16px; }
      .stage{ height:auto; }
      .characters{ grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>

<body>
  <!-- ì‹œì‘ í™”ë©´ -->
  <div id="startScreen">
    <div class="backdrop"></div>
    <div class="panelWrap">
      <div class="panel">
        <div class="title">ğŸ¸ ìºë¦­í„° ìƒì„± <span class="accent-dot"></span></div>
        <div class="subtitle">
          <b>ë½ìŠ¤íƒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì†Œë…€</b>ê°€ ì„±ì¥í•˜ëŠ” ì„ íƒí˜• RPG.<br>
          ë‹‰ë„¤ì„/ë‚˜ì´/ì„±ë³„ì„ ì •í•˜ë©´ ë°”ë¡œ ì‹œì‘ë©ë‹ˆë‹¤. (ì„œë²„ ì—†ìŒ Â· ì´ ê¸°ê¸°ì—ë§Œ ì €ì¥)
        </div>

        <div class="field">
          <label for="nick">ë‹‰ë„¤ì„</label>
          <input id="nick" maxlength="12" placeholder="ì˜ˆ: í† ë¯¸, ê°€ë„¤íŠ¸, ë½ìŠ¤íƒ€ê¿ˆë‚˜ë¬´" />
        </div>

        <div class="field">
          <label for="age">ë‚˜ì´</label>
          <select id="age">
            <option value="">ì„ íƒ</option>
            <option>10ëŒ€</option><option>20ëŒ€</option><option>30ëŒ€</option><option>40ëŒ€</option><option>50ëŒ€+</option>
          </select>
        </div>

        <div class="field">
          <label for="gender">ì„±ë³„</label>
          <select id="gender">
            <option value="">ì„ íƒ</option>
            <option value="ë‚¨">ë‚¨</option>
            <option value="ì—¬">ì—¬</option>
            <option value="ê¸°íƒ€">ê¸°íƒ€/ë¹„ê³µê°œ</option>
          </select>
        </div>

        <div class="startBtns">
          <button class="primary" id="btnStart">ì‹œì‘í•˜ê¸°</button>
          <button class="secondary" id="btnDemo">ë°ëª¨ë¡œ</button>
        </div>

        <div class="warn">
          â€» ë‹‰ë„¤ì„/ì„±ë³„/ë‚˜ì´ëŠ” ì ìˆ˜ ê³„ì‚°ì—ë§Œ ì‚¬ìš©ë  ìˆ˜ ìˆê³ , ì™¸ë¶€ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
        </div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="topbar">
      <div class="brand">ğŸ¸ ì˜¤ëŠ˜ì˜ì„ íƒ Â· ë½ìŠ¤íƒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì†Œë…€ (í”„ë¡œí† íƒ€ì…)</div>
      <div class="pill" id="userPill">ë¡œë”©ì¤‘â€¦</div>
    </div>

    <div class="stage" id="stage">
      <div class="characters">
        <div class="char">
          <!-- âœ… í”Œë ˆì´ì–´: ì´ë¯¸ì§€ + ê¸°ì¡´ ì• ë‹ˆë©”ì´ì…˜ ìœ ì§€ -->
          <div class="avatar is-idle" id="playerAvatar">
            <img src="assets/character/rockstar.png" alt="ë½ìŠ¤íƒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì†Œë…€">
          </div>
          <div class="meta">
            <div class="name" id="playerName">í”Œë ˆì´ì–´</div>
            <div class="role" id="playerRole">ë½ìŠ¤íƒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì†Œë…€ Â· ì„ íƒí•˜ëŠ” ì <span class="accent-dot"></span></div>
          </div>
        </div>

        <div class="char">
          <div class="avatar is-talk" id="npcAvatar">
            <div style="font-size:30px; filter: drop-shadow(0 10px 18px rgba(0,0,0,0.3));">ğŸ’¬</div>
          </div>
          <div class="meta">
            <div class="name" id="npcName">ë§¤ë‹ˆì €(ë¨¸ë¦¿ì†)</div>
            <div class="role">â€œì˜¤ëŠ˜ë„ ê¸°íƒ€ ì¡ì„ ê±°ì§€?â€</div>
          </div>
        </div>
      </div>

      <div class="dialogue">
        <div class="hud">
          <div class="progress">
            <span id="qIndexText">Q 1/10</span>
            <div class="bar"><div id="barFill"></div></div>
          </div>
          <div id="statusText">ì„ íƒí•˜ë©´ ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.</div>
        </div>

        <div class="box">
          <p class="question" id="questionText">ë¡œë”©ì¤‘â€¦</p>
          <p class="desc" id="questionDesc"></p>
          <div class="choices" id="choices"></div>
          <div class="row" style="margin-top:12px;">
            <button class="ghost" id="btnToggleLog">ë‚´ ê¸°ë¡ ë³´ê¸°/ë‹«ê¸°</button>
            <button class="ghost" id="btnResetAll">ì²˜ìŒë¶€í„° ë‹¤ì‹œ</button>
          </div>
        </div>
      </div>

      <div class="log" id="logPanel">
        <h3>ë‚´ ê¸°ë¡ (ì´ ê¸°ê¸°ì—ë§Œ ì €ì¥)</h3>
        <div id="logBody"></div>
      </div>
    </div>
  </div>

<script>
/** =========================
 *  ì €ì¥ í‚¤
 *  ========================= */
const LS_PROFILE = "mychoice_profile_v1";
const LS_RUN     = "mychoice_run_v1";
const LS_LOG     = "mychoice_log_v1";

/** =========================
 *  ì§ˆë¬¸(10ê°œ) - íŠœí† ë¦¬ì–¼/ì„±ì¥í˜•
 *  ========================= */
const QUESTIONS = [
  { q:"ì˜¤ëŠ˜ ì—°ìŠµì„ ì–¸ì œ í• ë˜?", desc:"ë½ìŠ¤íƒ€ëŠ” íƒ€ì´ë°ì´ ì•„ë‹ˆë¼ â€˜ë£¨í‹´â€™ì„ ê°€ì§„ë‹¤.",
    options:["ì§€ê¸ˆ 10ë¶„ë§Œì´ë¼ë„ ë°”ë¡œ í•œë‹¤","ì €ë…ì— ê° ì¡ê³  1ì‹œê°„ í•œë‹¤","ë‚´ì¼ ì»¨ë””ì…˜ ì¢‹ì„ ë•Œ í•œë‹¤","ì•ˆ í•œë‹¤â€¦(í•˜ì§€ë§Œ ì£„ì±…ê°ì€ ìˆë‹¤)"] },
  { q:"ê¸°íƒ€ë¥¼ ì§‘ì–´ë“œëŠ” ì´ìœ ëŠ”?", desc:"ëª©í‘œê°€ ì„ ëª…í•˜ë©´ í”ë“¤ë ¤ë„ ë‹¤ì‹œ ëŒì•„ì˜¨ë‹¤.",
    options:["ë¬´ëŒ€ì—ì„œ í„°ëœ¨ë¦¬ê³  ì‹¶ì–´ì„œ","ìŠ¤íŠ¸ë ˆìŠ¤ í’€ë ¤ê³ ","ë©‹ìˆì–´ ë³´ì—¬ì„œ","ê·¸ëƒ¥â€¦ ìŠµê´€ì²˜ëŸ¼"] },
  { q:"ì—°ìŠµí•  ë•Œ ê°€ì¥ ë¨¼ì € í•˜ëŠ” ê±´?", desc:"ì´ˆë°˜ 5ë¶„ì´ ê·¸ë‚  í€„ë¦¬í‹°ë¥¼ ê²°ì •í•œë‹¤.",
    options:["ì›Œë°ì—…(í¬ë¡œë§¤í‹±/ìŠ¤íŠ¸ë ˆì¹­)","ì¢‹ì•„í•˜ëŠ” ê³¡ë¶€í„° ì³ì„œ í…ì…˜ ì˜¬ë¦¼","ìƒˆë¡œ ë°°ìš°ëŠ” í”„ë ˆì´ì¦ˆ íŒŒê³ ë“¦","ìœ íŠœë¸Œ ì¼œê³  â€˜ë³´ê³  ë”°ë¼í•˜ê¸°â€™"] },
  { q:"ê¸°ìˆ ì´ ë§‰í ë•Œ ë„ˆì˜ ì„ íƒì€?", desc:"ë§‰íˆëŠ” êµ¬ê°„ì´ ì‹¤ë ¥ì˜ ê´€ë¬¸ì´ë‹¤.",
    options:["ë©”íŠ¸ë¡œë†ˆ ì¼œê³  ëŠë¦¬ê²Œ ìª¼ê° ë‹¤","ì†í’€ë¦´ ë•Œê¹Œì§€ ë°˜ë³µí•œë‹¤","í¬ê¸°í•˜ê³  ë‹¤ë¥¸ ê±° í•œë‹¤","ê°•ì˜/ë ˆìŠ¨ ìë£Œë¥¼ ì°¾ëŠ”ë‹¤"] },
  { q:"ë…¹ìŒ/ì´¬ì˜ì„ í•œë‹¤ë©´?", desc:"ê¸°ë¡ì€ ì‹¤ë ¥ í–¥ìƒì˜ ì¹˜íŠ¸í‚¤ë‹¤.",
    options:["ì§§ê²Œë¼ë„ ë§¤ì¼ ê¸°ë¡í•œë‹¤","ì£¼ 1íšŒ ì œëŒ€ë¡œ ì°ëŠ”ë‹¤","ê°€ë” ìƒê°ë‚  ë•Œë§Œ","ë¶€ë„ëŸ¬ì›Œì„œ ì•ˆ í•œë‹¤"] },
  { q:"ì‚¬ëŒ ì• ê³µí¬ê°€ ì˜¨ë‹¤ë©´?", desc:"ë¬´ëŒ€ëŠ” ì—°ìŠµëŸ‰ì˜ ê±°ì§“ë§ì„ ëª» ë³¸ë‹¤.",
    options:["ì‘ê²Œë¼ë„ ì‚¬ëŒ ì•ì—ì„œ ìì£¼ í•´ë³¸ë‹¤","ì™„ë²½í•´ì§ˆ ë•Œê¹Œì§€ ìˆ¨ëŠ”ë‹¤","ì¹œêµ¬ 1ëª… ì•ì—ì„œë¶€í„° ì‹œì‘","ì•„ì˜ˆ ë¬´ëŒ€ëŠ” ë‚´ ê¸¸ì´ ì•„ë‹Œ ë“¯"] },
  { q:"ì¥ë¹„ ì—…ê·¸ë ˆì´ë“œ ìš•êµ¬ê°€ í­ë°œ!", desc:"ì¥ë¹„ëŠ” ë„ì›€ì´ ë˜ì§€ë§Œ, ì‹¤ë ¥ì€ ë” ì§ì ‘ì ì´ë‹¤.",
    options:["ì§€ê¸ˆ ìˆëŠ” ê±¸ë¡œ í†¤ ì„¸íŒ…ë¶€í„° íŒŒë³¸ë‹¤","í•„ìš”í•œ ê²ƒë§Œ ë”± í•˜ë‚˜ ì‚°ë‹¤","ì¶©ë™êµ¬ë§¤ ê°„ë‹¤(í–‰ë³µì€ ì ê¹)","ë¦¬ë·°ë§Œ 3ì‹œê°„ ë³¸ë‹¤(ê·¸ë¦¬ê³  ì•ˆ ì‚°ë‹¤)"] },
  { q:"ë°´ë“œ/í•©ì£¼ ì œì•ˆì´ ì™”ë‹¤ë©´?", desc:"í•©ì£¼ëŠ” ì‹¤ì „ì´ê³ , ì‹¤ì „ì€ ì„±ì¥ì´ë‹¤.",
    options:["ì¼ë‹¨ í•œë‹¤. ë¶€ì¡±í•˜ë©´ ì±„ìš°ë©´ ë¨","ì¡°ê±´(ê³¡/ìŠ¤ì¼€ì¤„) ë§ìœ¼ë©´ í•œë‹¤","ì‹¤ë ¥ ë” ìŒ“ê³  ë‚˜ì¤‘ì—","ì‚¬ëŒ ë§ì¶”ëŠ” ê²Œ ë” í”¼ê³¤í•¨â€¦"] },
  { q:"ê³¡ì„ ë§Œë“¤ ê¸°íšŒê°€ ìƒê²¼ë‹¤.", desc:"â€˜ë‚´ ìƒ‰â€™ì€ ê²°êµ­ ìŒ“ì¸ ì„ íƒì—ì„œ ë‚˜ì˜¨ë‹¤.",
    options:["ë¦¬í”„ë¶€í„° ë½‘ëŠ”ë‹¤(ì†ì´ ë¨¼ì €)","ê°ì •/ìŠ¤í† ë¦¬ë¶€í„° ì¡ëŠ”ë‹¤","ë ˆí¼ëŸ°ìŠ¤ ì¡°ì‚¬í•˜ê³  êµ¬ì¡°ë¥¼ ì§ ë‹¤","ì¦‰í¥ìœ¼ë¡œ ë…¹ìŒí•˜ê³  ê±°ê¸°ì„œ ë½‘ëŠ”ë‹¤"] },
  { q:"ë§ˆì§€ë§‰ ì§ˆë¬¸. ì˜¤ëŠ˜ì˜ ë„ˆëŠ”?", desc:"ëì´ ì•„ë‹ˆë¼ ëˆ„ì ì˜ ì‹œì‘ì´ë‹¤.",
    options:["ê°€ê¹Œì› ë‹¤. í–‰ë™í–ˆë‹¤.","ë°˜ë°˜. ë§ˆìŒì€ ìˆì—ˆê³  ì¡°ê¸ˆ í–ˆë‹¤.","ë©€ì—ˆë‹¤. í•˜ì§€ë§Œ ë‚´ì¼ì€ ë‹¤ë¥´ê²Œ.","ëª¨ë¥´ê² ë‹¤. ê·¸ë˜ë„ ê¸°íƒ€ëŠ” ë†“ì§€ ì•Šê² ë‹¤."] },
];

/** DOM */
const startScreen = document.getElementById("startScreen");
const nickEl = document.getElementById("nick");
const ageEl = document.getElementById("age");
const genderEl = document.getElementById("gender");
const btnStart = document.getElementById("btnStart");
const btnDemo = document.getElementById("btnDemo");

const userPill = document.getElementById("userPill");
const playerName = document.getElementById("playerName");
const playerRole = document.getElementById("playerRole");
const playerAvatar = document.getElementById("playerAvatar");
const npcAvatar = document.getElementById("npcAvatar");

const qIndexText = document.getElementById("qIndexText");
const barFill = document.getElementById("barFill");
const statusText = document.getElementById("statusText");
const questionText = document.getElementById("questionText");
const questionDesc = document.getElementById("questionDesc");
const choices = document.getElementById("choices");

const btnToggleLog = document.getElementById("btnToggleLog");
const btnResetAll = document.getElementById("btnResetAll");
const logPanel = document.getElementById("logPanel");
const logBody = document.getElementById("logBody");

/** ìœ í‹¸ */
function nowKST(){ return new Date().toLocaleString("ko-KR"); }
function setState(el, state){
  el.classList.remove("is-idle","is-talk","is-react");
  el.classList.add(state);
}
function loadJSON(key, fallback){
  try { return JSON.parse(localStorage.getItem(key) || ""); }
  catch { return fallback; }
}
function saveJSON(key, value){ localStorage.setItem(key, JSON.stringify(value)); }

/** í”„ë¡œí•„ */
function loadProfile(){ return loadJSON(LS_PROFILE, null); }
function saveProfile(profile){ saveJSON(LS_PROFILE, profile); }
function applyProfile(profile){
  const nick = profile?.nick || "í”Œë ˆì´ì–´";
  const age = profile?.age || "";
  const gender = profile?.gender || "";
  playerName.textContent = nick;
  userPill.textContent = `${nick}${age ? " Â· "+age : ""}${gender ? " Â· "+gender : ""}`;
  // ì—­í•  ë¬¸êµ¬ë„ ì‚´ì§ ë” í…Œë§ˆ ë§ì¶¤
  playerRole.innerHTML = `ë½ìŠ¤íƒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì†Œë…€ Â· ${nick} <span class="accent-dot"></span>`;
}

/** ì§„í–‰ */
function initRun(){
  const run = { idx: 0, answers: [] };
  saveJSON(LS_RUN, run);
  return run;
}
function loadRun(){ return loadJSON(LS_RUN, null); }
function saveRun(run){ saveJSON(LS_RUN, run); }

/** ë¡œê·¸ */
function addLog(entry){
  const logs = loadJSON(LS_LOG, []);
  logs.unshift(entry);
  saveJSON(LS_LOG, logs);
}
function escapeHTML(s){
  return String(s)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
function renderLog(){
  const logs = loadJSON(LS_LOG, []);
  if (logs.length === 0){
    logBody.innerHTML = `<div class="item"><div class="t">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div></div>`;
    return;
  }
  logBody.innerHTML = logs.slice(0, 50).map(l => `
    <div class="item">
      <div class="t">[${l.time}]</div>
      <div><b>${escapeHTML(l.answer)}</b></div>
      <div class="q">${escapeHTML(l.question)}</div>
    </div>
  `).join("");
}

/** ì§ˆë¬¸ ë Œë” */
function renderQuestion(run){
  const total = QUESTIONS.length;
  const idx = run.idx;

  if (idx >= total){
    renderEnding(run);
    return;
  }

  const q = QUESTIONS[idx];
  qIndexText.textContent = `Q ${idx+1}/${total}`;
  barFill.style.width = `${Math.round(((idx) / total) * 100)}%`;

  questionText.textContent = q.q;
  questionDesc.textContent = q.desc;

  setState(npcAvatar, "is-talk");
  setState(playerAvatar, "is-idle");

  choices.innerHTML = "";
  q.options.forEach((opt, i) => {
    const b = document.createElement("button");
    b.className = "choice";
    b.textContent = `${["A","B","C","D"][i]}. ${opt}`;
    b.onclick = () => onChoose(run, opt);
    choices.appendChild(b);
  });

  statusText.textContent = "ì„ íƒí•˜ë©´ ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.";
}

function onChoose(run, answer){
  const idx = run.idx;
  const q = QUESTIONS[idx];

  setState(playerAvatar, "is-react");
  setTimeout(() => setState(playerAvatar, "is-idle"), 380);

  run.answers.push({ question: q.q, answer, at: new Date().toISOString() });
  addLog({ time: nowKST(), question: q.q, answer });

  run.idx += 1;
  saveRun(run);
  renderLog();

  statusText.textContent = "ê¸°ë¡ ì™„ë£Œ. ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ì´ë™â€¦";
  setTimeout(() => renderQuestion(run), 420);
}

function renderEnding(run){
  barFill.style.width = `100%`;
  qIndexText.textContent = `END Â· 10/10`;
  setState(npcAvatar, "is-idle");
  setState(playerAvatar, "is-idle");

  const nick = loadProfile()?.nick || "í”Œë ˆì´ì–´";

  questionText.textContent = `${nick}ì˜ ì˜¤ëŠ˜ì€ ì €ì¥ëë‹¤.`;
  questionDesc.textContent =
    "ì´ê±´ ëì´ ì•„ë‹ˆë¼ â€˜ëˆ„ì â€™ì˜ ì‹œì‘ì´ë‹¤. ë‚´ì¼ ë˜ ì„ íƒí•˜ë©´ ë„ˆëŠ” ë¶„ëª… ë‹¬ë¼ì§„ë‹¤.";

  choices.innerHTML = `
    <button class="choice" id="btnRestart">ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°</button>
    <button class="choice" id="btnCloseLog">ë‚´ ê¸°ë¡ ë³´ê¸°/ë‹«ê¸°</button>
  `;

  document.getElementById("btnRestart").onclick = () => {
    if (confirm("ì§„í–‰ìƒí™©(10ë¬¸í•­)ì„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ í• ê¹Œìš”? (ê¸°ë¡ ë¡œê·¸ëŠ” ìœ ì§€ë©ë‹ˆë‹¤)")){
      const newRun = initRun();
      renderQuestion(newRun);
    }
  };
  document.getElementById("btnCloseLog").onclick = () => toggleLog();

  statusText.textContent = "ì—”ë”©. ë‹¤ì‹œí•˜ê¸° ë˜ëŠ” ê¸°ë¡ í™•ì¸.";
}

function toggleLog(){
  const isHidden = getComputedStyle(logPanel).display === "none";
  logPanel.style.display = isHidden ? "block" : "none";
}

function resetAll(){
  if (!confirm("í”„ë¡œí•„/ì§„í–‰/ê¸°ë¡ì„ ì „ë¶€ ì‚­ì œí•˜ê³  ì²˜ìŒë¶€í„° ì‹œì‘í• ê¹Œìš”?")) return;
  localStorage.removeItem(LS_PROFILE);
  localStorage.removeItem(LS_RUN);
  localStorage.removeItem(LS_LOG);
  location.reload();
}

/** ì‹œì‘ íë¦„ */
function showStart(){ startScreen.style.display = "block"; }
function hideStart(){ startScreen.style.display = "none"; }

btnStart.addEventListener("click", () => {
  const nick = (nickEl.value || "").trim();
  const age = ageEl.value;
  const gender = genderEl.value;

  if (!nick || !age || !gender){
    alert("ë‹‰ë„¤ì„/ë‚˜ì´/ì„±ë³„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
    return;
  }
  saveProfile({ nick, age, gender });
  hideStart();
  boot();
});

btnDemo.addEventListener("click", () => {
  saveProfile({ nick: "ë°ëª¨ë¡ìŠ¤íƒ€", age: "20ëŒ€", gender: "ê¸°íƒ€" });
  hideStart();
  boot();
});

function boot(){
  const profile = loadProfile();
  if (!profile){
    showStart();
    return;
  }
  applyProfile(profile);

  let run = loadRun();
  if (!run) run = initRun();

  renderLog();
  renderQuestion(run);
}

btnToggleLog.addEventListener("click", toggleLog);
btnResetAll.addEventListener("click", resetAll);

boot();
</script>
</body>
</html>
