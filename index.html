<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ì˜¤ëŠ˜ì˜ì„ íƒ Â· ë½ìŠ¤íƒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì†Œë…€ (í”„ë¡œí† íƒ€ì…)</title>
  <style>
    :root{
      --safe-top: env(safe-area-inset-top);
      --safe-bot: env(safe-area-inset-bottom);
      --text: #f4f6ff;
      --muted: rgba(244,246,255,0.74);
      --muted2: rgba(244,246,255,0.55);
      --border: rgba(255,255,255,0.14);
      --panel: rgba(10,14,26,0.62);
      --panel2: rgba(10,14,26,0.82);
      --accent: rgba(255,60,95,0.90);
      --shadow: rgba(0,0,0,0.55);
    }

    html, body { height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: var(--text);
      background:#05070f;
      overflow:hidden;
    }

    /* ===== í’€ìŠ¤í¬ë¦° ê²Œì„ ìº”ë²„ìŠ¤ ===== */
    .game{
      position:relative;
      height:100svh;
      width:100%;
      overflow:hidden;
      padding: calc(10px + var(--safe-top)) 12px calc(10px + var(--safe-bot));
      box-sizing:border-box;
    }

    /* ë°°ê²½ (íŒŒì¼ ìˆìœ¼ë©´ ê¹”ë¦¬ê³ , ì—†ì–´ë„ ê·¸ë¼ë°ì´ì…˜ìœ¼ë¡œ ë²„íŒ€) */
    .bg{
      position:absolute; inset:0;
      background:
        radial-gradient(1200px 800px at 70% 20%, rgba(255,60,95,0.18), transparent 55%),
        radial-gradient(900px 700px at 20% 10%, rgba(120,180,255,0.14), transparent 60%),
        linear-gradient(180deg, #070a15 0%, #05070f 55%, #04050c 100%);
      z-index:0;
    }
    .bg::after{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(100% 70% at 50% 25%, transparent 30%, rgba(0,0,0,0.55) 100%);
    }

    /* ===== ìºë¦­í„° ===== */
    .character{
      position:absolute;
      inset:0;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      padding-bottom: 18svh; /* í•˜ë‹¨ UIì— ê°€ë¦¬ì§€ ì•Šê²Œ */
      z-index:1;
      pointer-events:none;
    }

    .sprite{
      width:min(92vw, 520px);
      height:auto;
      filter: drop-shadow(0 20px 55px rgba(0,0,0,0.55));
      transform-origin: 50% 90%;
      will-change: transform;
      user-select:none;
      -webkit-user-drag:none;
    }

    /* ìƒíƒœ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes idleBreath {
      0%,100%{ transform: translateY(0) scale(1); }
      50%{ transform: translateY(-6px) scale(1.01); }
    }
    @keyframes talkNod {
      0%,100%{ transform: translateY(-2px) rotate(0deg) scale(1.01); }
      25%{ transform: translateY(-7px) rotate(-1.2deg) scale(1.015); }
      75%{ transform: translateY(-7px) rotate(1.2deg) scale(1.015); }
    }
    @keyframes reactPop {
      0%{ transform: translateY(0) scale(1); }
      35%{ transform: translateY(-12px) scale(1.06); }
      100%{ transform: translateY(-2px) scale(1.01); }
    }
    .is-idle { animation: idleBreath 3.2s ease-in-out infinite; }
    .is-talk { animation: talkNod 0.7s ease-in-out infinite; }
    .is-react{ animation: reactPop 0.35s ease-out; }

    /* ===== ìƒë‹¨ HUD ===== */
    .hud{
      position:relative;
      z-index:3;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .brand{
      display:flex; align-items:center; gap:8px;
      font-weight:900;
      letter-spacing:0.2px;
      text-shadow: 0 10px 25px rgba(0,0,0,0.45);
    }
    .pill{
      font-size:12px;
      padding:7px 10px;
      border:1px solid var(--border);
      border-radius:999px;
      background: rgba(255,255,255,0.06);
      color: var(--muted);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      white-space:nowrap;
    }
    .progressWrap{
      display:flex; align-items:center; gap:10px;
      font-size:12px; color: var(--muted);
    }
    .bar{
      width: 140px;
      height: 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.08);
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: rgba(255,255,255,0.78);
    }

    /* ===== í•˜ë‹¨ ëŒ€í™”ì°½ ===== */
    .dialog{
      position:absolute;
      left: 12px;
      right: 12px;
      bottom: calc(12px + var(--safe-bot));
      z-index:3;
    }

    .textbox{
      border: 1px solid rgba(255,255,255,0.16);
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(10,14,26,0.60), rgba(10,14,26,0.88));
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 22px 65px rgba(0,0,0,0.55);
      overflow:hidden;
    }

    .textboxHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      color: var(--muted);
      font-size: 12px;
    }

    .speaker{
      display:flex; align-items:center; gap:8px;
      font-weight:800;
      color: rgba(244,246,255,0.88);
    }
    .dot{
      width:10px; height:10px; border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 16px rgba(255,60,95,0.60);
    }

    .textboxBody{
      padding: 14px;
    }
    .q{
      margin:0 0 6px 0;
      font-size: 20px;
      font-weight: 950;
      letter-spacing: -0.2px;
    }
    .desc{
      margin:0 0 12px 0;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.35;
    }

    .choices{
      display:grid;
      gap: 10px;
      padding-bottom: 6px;
      max-height: 26svh;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }

    button.choice{
      text-align:left;
      padding: 14px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.08);
      color: var(--text);
      font-size: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }
    button.choice:active{ transform: translateY(1px); }

    .row{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top: 10px;
    }
    button.ghost{
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.12);
      color: rgba(244,246,255,0.86);
      font-size: 13px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    /* ì‹œì‘ í™”ë©´(ìºë¦­í„° ìƒì„±) */
    #startScreen{
      position: fixed;
      inset: 0;
      z-index: 9999;
      display:none;
    }
    #startScreen .backdrop{
      position:absolute; inset:0;
      background: rgba(0,0,0,0.76);
    }
    #startScreen .panelWrap{
      position:relative;
      height: 100svh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: calc(18px + var(--safe-top)) 16px calc(18px + var(--safe-bot));
      box-sizing:border-box;
    }
    #startScreen .panel{
      width:100%;
      max-width: 520px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,0.16);
      background: rgba(10,14,25,0.94);
      padding: 18px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.45);
    }
    .title{
      font-weight: 950;
      font-size: 18px;
      margin-bottom: 6px;
      display:flex; align-items:center; gap:8px;
    }
    .subtitle{
      font-size: 13px;
      color: var(--muted);
      line-height: 1.35;
      margin-bottom: 14px;
    }
    .field{ margin: 12px 0; }
    .field label{
      display:block;
      font-size: 12px;
      color: rgba(244,246,255,0.75);
      margin-bottom: 6px;
    }
    .field input, .field select{
      width:100%;
      box-sizing:border-box;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      font-size: 15px;
      outline: none;
    }
    .startBtns{ display:flex; gap:10px; margin-top:14px; }
    .primary{
      flex:1;
      padding: 13px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,60,95,0.18);
      color: var(--text);
      font-weight: 900;
      font-size: 15px;
    }
    .secondary{
      padding: 13px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.14);
      background: transparent;
      color: rgba(244,246,255,0.85);
      font-weight: 800;
      font-size: 15px;
      white-space: nowrap;
    }
  </style>
</head>

<body>

<!-- ì‹œì‘ í™”ë©´ -->
<div id="startScreen">
  <div class="backdrop"></div>
  <div class="panelWrap">
    <div class="panel">
      <div class="title">ğŸ¸ ìºë¦­í„° ìƒì„± <span class="dot"></span></div>
      <div class="subtitle">
        <b>ë½ìŠ¤íƒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì†Œë…€</b>ê°€ ì„±ì¥í•˜ëŠ” ì„ íƒí˜• RPG.<br>
        ë‹‰ë„¤ì„/ë‚˜ì´/ì„±ë³„ì„ ì •í•˜ë©´ ë°”ë¡œ ì‹œì‘ë©ë‹ˆë‹¤. (ì„œë²„ ì—†ìŒ Â· ì´ ê¸°ê¸°ì—ë§Œ ì €ì¥)
      </div>

      <div class="field">
        <label for="nick">ë‹‰ë„¤ì„</label>
        <input id="nick" maxlength="12" />
      </div>

      <div class="field">
        <label for="age">ë‚˜ì´</label>
        <select id="age">
          <option value="">ì„ íƒ</option>
          <option>10ëŒ€</option><option>20ëŒ€</option><option>30ëŒ€</option><option>40ëŒ€</option><option>50ëŒ€+</option>
        </select>
      </div>

      <div class="field">
        <label for="gender">ì„±ë³„</label>
        <select id="gender">
          <option value="">ì„ íƒ</option>
          <option value="ë‚¨">ë‚¨</option>
          <option value="ì—¬">ì—¬</option>
          <option value="ê¸°íƒ€">ê¸°íƒ€/ë¹„ê³µê°œ</option>
        </select>
      </div>

      <div class="startBtns">
        <button class="primary" id="btnStart">ì‹œì‘í•˜ê¸°</button>
        <button class="secondary" id="btnDemo">ë°ëª¨ë¡œ</button>
      </div>
    </div>
  </div>
</div>

<div class="game">
  <div class="bg"></div>

  <div class="hud">
    <div class="brand">ğŸ¸ ì˜¤ëŠ˜ì˜ì„ íƒ Â· ë½ìŠ¤íƒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì†Œë…€</div>
    <div class="progressWrap">
      <span id="qIndexText">Q 1/10</span>
      <div class="bar"><div id="barFill"></div></div>
      <div class="pill" id="userPill">ë¡œë”©ì¤‘â€¦</div>
    </div>
  </div>

  <!-- í’€ì‚¬ì´ì¦ˆ ìºë¦­í„° -->
  <div class="character">
    <img id="playerSprite" class="sprite is-idle" src="/Mychoice-prototype/assets/character/rockstar.png" alt="ë½ìŠ¤íƒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì†Œë…€">
  </div>

  <!-- í•˜ë‹¨ ëŒ€í™”ì°½ -->
  <div class="dialog">
    <div class="textbox">
      <div class="textboxHeader">
        <div class="speaker">
          <span class="dot"></span>
          <span id="speakerName">ë§¤ë‹ˆì €(ë¨¸ë¦¿ì†)</span>
        </div>
        <div id="statusText">ì„ íƒí•˜ë©´ ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.</div>
      </div>

      <div class="textboxBody">
        <p class="q" id="questionText">ë¡œë”©ì¤‘â€¦</p>
        <p class="desc" id="questionDesc"></p>
        <div class="choices" id="choices"></div>

        <div class="row">
          <button class="ghost" id="btnResetAll">ì²˜ìŒë¶€í„° ë‹¤ì‹œ</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const LS_PROFILE = "mychoice_profile_v1";
const LS_RUN     = "mychoice_run_v1";

const QUESTIONS = [
  { q:"ì˜¤ëŠ˜ ì—°ìŠµì„ ì–¸ì œ í• ë˜?", desc:"ë½ìŠ¤íƒ€ëŠ” íƒ€ì´ë°ì´ ì•„ë‹ˆë¼ â€˜ë£¨í‹´â€™ì„ ê°€ì§„ë‹¤.",
    options:["ì§€ê¸ˆ 10ë¶„ë§Œì´ë¼ë„ ë°”ë¡œ í•œë‹¤","ì €ë…ì— ê° ì¡ê³  1ì‹œê°„ í•œë‹¤","ë‚´ì¼ ì»¨ë””ì…˜ ì¢‹ì„ ë•Œ í•œë‹¤","ì•ˆ í•œë‹¤â€¦(í•˜ì§€ë§Œ ì£„ì±…ê°ì€ ìˆë‹¤)"] },
  { q:"ê¸°íƒ€ë¥¼ ì§‘ì–´ë“œëŠ” ì´ìœ ëŠ”?", desc:"ëª©í‘œê°€ ì„ ëª…í•˜ë©´ í”ë“¤ë ¤ë„ ë‹¤ì‹œ ëŒì•„ì˜¨ë‹¤.",
    options:["ë¬´ëŒ€ì—ì„œ í„°ëœ¨ë¦¬ê³  ì‹¶ì–´ì„œ","ìŠ¤íŠ¸ë ˆìŠ¤ í’€ë ¤ê³ ","ë©‹ìˆì–´ ë³´ì—¬ì„œ","ê·¸ëƒ¥â€¦ ìŠµê´€ì²˜ëŸ¼"] },
  { q:"ì—°ìŠµí•  ë•Œ ê°€ì¥ ë¨¼ì € í•˜ëŠ” ê±´?", desc:"ì´ˆë°˜ 5ë¶„ì´ ê·¸ë‚  í€„ë¦¬í‹°ë¥¼ ê²°ì •í•œë‹¤.",
    options:["ì›Œë°ì—…(í¬ë¡œë§¤í‹±/ìŠ¤íŠ¸ë ˆì¹­)","ì¢‹ì•„í•˜ëŠ” ê³¡ë¶€í„° ì³ì„œ í…ì…˜ ì˜¬ë¦¼","ìƒˆë¡œ ë°°ìš°ëŠ” í”„ë ˆì´ì¦ˆ íŒŒê³ ë“¦","ìœ íŠœë¸Œ ì¼œê³  â€˜ë³´ê³  ë”°ë¼í•˜ê¸°â€™"] },
  { q:"ê¸°ìˆ ì´ ë§‰í ë•Œ ë„ˆì˜ ì„ íƒì€?", desc:"ë§‰íˆëŠ” êµ¬ê°„ì´ ì‹¤ë ¥ì˜ ê´€ë¬¸ì´ë‹¤.",
    options:["ë©”íŠ¸ë¡œë†ˆ ì¼œê³  ëŠë¦¬ê²Œ ìª¼ê° ë‹¤","ì†í’€ë¦´ ë•Œê¹Œì§€ ë°˜ë³µí•œë‹¤","í¬ê¸°í•˜ê³  ë‹¤ë¥¸ ê±° í•œë‹¤","ê°•ì˜/ë ˆìŠ¨ ìë£Œë¥¼ ì°¾ëŠ”ë‹¤"] },
  { q:"ë…¹ìŒ/ì´¬ì˜ì„ í•œë‹¤ë©´?", desc:"ê¸°ë¡ì€ ì‹¤ë ¥ í–¥ìƒì˜ ì¹˜íŠ¸í‚¤ë‹¤.",
    options:["ì§§ê²Œë¼ë„ ë§¤ì¼ ê¸°ë¡í•œë‹¤","ì£¼ 1íšŒ ì œëŒ€ë¡œ ì°ëŠ”ë‹¤","ê°€ë” ìƒê°ë‚  ë•Œë§Œ","ë¶€ë„ëŸ¬ì›Œì„œ ì•ˆ í•œë‹¤"] },
  { q:"ì‚¬ëŒ ì• ê³µí¬ê°€ ì˜¨ë‹¤ë©´?", desc:"ë¬´ëŒ€ëŠ” ì—°ìŠµëŸ‰ì˜ ê±°ì§“ë§ì„ ëª» ë³¸ë‹¤.",
    options:["ì‘ê²Œë¼ë„ ì‚¬ëŒ ì•ì—ì„œ ìì£¼ í•´ë³¸ë‹¤","ì™„ë²½í•´ì§ˆ ë•Œê¹Œì§€ ìˆ¨ëŠ”ë‹¤","ì¹œêµ¬ 1ëª… ì•ì—ì„œë¶€í„° ì‹œì‘","ì•„ì˜ˆ ë¬´ëŒ€ëŠ” ë‚´ ê¸¸ì´ ì•„ë‹Œ ë“¯"] },
  { q:"ì¥ë¹„ ì—…ê·¸ë ˆì´ë“œ ìš•êµ¬ê°€ í­ë°œ!", desc:"ì¥ë¹„ëŠ” ë„ì›€ì´ ë˜ì§€ë§Œ, ì‹¤ë ¥ì€ ë” ì§ì ‘ì ì´ë‹¤.",
    options:["ì§€ê¸ˆ ìˆëŠ” ê±¸ë¡œ í†¤ ì„¸íŒ…ë¶€í„° íŒŒë³¸ë‹¤","í•„ìš”í•œ ê²ƒë§Œ ë”± í•˜ë‚˜ ì‚°ë‹¤","ì¶©ë™êµ¬ë§¤ ê°„ë‹¤(í–‰ë³µì€ ì ê¹)","ë¦¬ë·°ë§Œ 3ì‹œê°„ ë³¸ë‹¤(ê·¸ë¦¬ê³  ì•ˆ ì‚°ë‹¤)"] },
  { q:"ë°´ë“œ/í•©ì£¼ ì œì•ˆì´ ì™”ë‹¤ë©´?", desc:"í•©ì£¼ëŠ” ì‹¤ì „ì´ê³ , ì‹¤ì „ì€ ì„±ì¥ì´ë‹¤.",
    options:["ì¼ë‹¨ í•œë‹¤. ë¶€ì¡±í•˜ë©´ ì±„ìš°ë©´ ë¨","ì¡°ê±´(ê³¡/ìŠ¤ì¼€ì¤„) ë§ìœ¼ë©´ í•œë‹¤","ì‹¤ë ¥ ë” ìŒ“ê³  ë‚˜ì¤‘ì—","ì‚¬ëŒ ë§ì¶”ëŠ” ê²Œ ë” í”¼ê³¤í•¨â€¦"] },
  { q:"ê³¡ì„ ë§Œë“¤ ê¸°íšŒê°€ ìƒê²¼ë‹¤.", desc:"â€˜ë‚´ ìƒ‰â€™ì€ ê²°êµ­ ìŒ“ì¸ ì„ íƒì—ì„œ ë‚˜ì˜¨ë‹¤.",
    options:["ë¦¬í”„ë¶€í„° ë½‘ëŠ”ë‹¤(ì†ì´ ë¨¼ì €)","ê°ì •/ìŠ¤í† ë¦¬ë¶€í„° ì¡ëŠ”ë‹¤","ë ˆí¼ëŸ°ìŠ¤ ì¡°ì‚¬í•˜ê³  êµ¬ì¡°ë¥¼ ì§ ë‹¤","ì¦‰í¥ìœ¼ë¡œ ë…¹ìŒí•˜ê³  ê±°ê¸°ì„œ ë½‘ëŠ”ë‹¤"] },
  { q:"ë§ˆì§€ë§‰ ì§ˆë¬¸. ì˜¤ëŠ˜ì˜ ë„ˆëŠ”?", desc:"ëì´ ì•„ë‹ˆë¼ ëˆ„ì ì˜ ì‹œì‘ì´ë‹¤.",
    options:["ê°€ê¹Œì› ë‹¤. í–‰ë™í–ˆë‹¤.","ë°˜ë°˜. ë§ˆìŒì€ ìˆì—ˆê³  ì¡°ê¸ˆ í–ˆë‹¤.","ë©€ì—ˆë‹¤. í•˜ì§€ë§Œ ë‚´ì¼ì€ ë‹¤ë¥´ê²Œ.","ëª¨ë¥´ê² ë‹¤. ê·¸ë˜ë„ ê¸°íƒ€ëŠ” ë†“ì§€ ì•Šê² ë‹¤."] },
];

const startScreen = document.getElementById("startScreen");
const nickEl = document.getElementById("nick");
const ageEl = document.getElementById("age");
const genderEl = document.getElementById("gender");
const btnStart = document.getElementById("btnStart");
const btnDemo = document.getElementById("btnDemo");

const qIndexText = document.getElementById("qIndexText");
const barFill = document.getElementById("barFill");
const userPill = document.getElementById("userPill");

const speakerName = document.getElementById("speakerName");
const statusText = document.getElementById("statusText");
const questionText = document.getElementById("questionText");
const questionDesc = document.getElementById("questionDesc");
const choices = document.getElementById("choices");
const btnResetAll = document.getElementById("btnResetAll");

const playerSprite = document.getElementById("playerSprite");

function setState(state){
  playerSprite.classList.remove("is-idle","is-talk","is-react");
  playerSprite.classList.add(state);
}

function loadJSON(key, fallback){
  try { return JSON.parse(localStorage.getItem(key) || ""); }
  catch { return fallback; }
}
function saveJSON(key, value){ localStorage.setItem(key, JSON.stringify(value)); }

function showStart(){ startScreen.style.display = "block"; }
function hideStart(){ startScreen.style.display = "none"; }

function applyProfile(p){
  const nick = p?.nick || "í”Œë ˆì´ì–´";
  const age = p?.age || "";
  const gender = p?.gender || "";
  userPill.textContent = `${nick}${age ? " Â· "+age : ""}${gender ? " Â· "+gender : ""}`;
}

function initRun(){ const run = { idx: 0 }; saveJSON(LS_RUN, run); return run; }
function loadRun(){ return loadJSON(LS_RUN, null); }
function saveRun(run){ saveJSON(LS_RUN, run); }

function renderQuestion(run){
  const total = QUESTIONS.length;
  const idx = run.idx;

  if (idx >= total){
    qIndexText.textContent = `END Â· 10/10`;
    barFill.style.width = "100%";
    setState("is-idle");
    speakerName.textContent = "ë§¤ë‹ˆì €(ë¨¸ë¦¿ì†)";
    questionText.textContent = "ì˜¤ëŠ˜ì˜ ì„ íƒì€ ì €ì¥ëë‹¤.";
    questionDesc.textContent = "ëì´ ì•„ë‹ˆë¼ ëˆ„ì ì´ë‹¤. ë‚´ì¼ ë˜ ì„ íƒí•˜ë©´, ë„ˆëŠ” ë‹¬ë¼ì§„ë‹¤.";
    choices.innerHTML = `<button class="choice" id="btnRestart">ì²˜ìŒë¶€í„° ë‹¤ì‹œ</button>`;
    document.getElementById("btnRestart").onclick = () => { const nr = initRun(); renderQuestion(nr); };
    statusText.textContent = "ì—”ë”©.";
    return;
  }

  qIndexText.textContent = `Q ${idx+1}/${total}`;
  barFill.style.width = `${Math.round((idx / total) * 100)}%`;

  const q = QUESTIONS[idx];
  speakerName.textContent = "ë§¤ë‹ˆì €(ë¨¸ë¦¿ì†)";
  questionText.textContent = q.q;
  questionDesc.textContent = q.desc;

  setState("is-talk");

  choices.innerHTML = "";
  q.options.forEach((opt, i) => {
    const b = document.createElement("button");
    b.className = "choice";
    b.textContent = `${["A","B","C","D"][i]}. ${opt}`;
    b.onclick = () => onChoose(run);
    choices.appendChild(b);
  });

  statusText.textContent = "ì„ íƒí•˜ë©´ ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.";
}

function onChoose(run){
  setState("is-react");
  setTimeout(() => setState("is-idle"), 380);
  run.idx += 1;
  saveRun(run);
  statusText.textContent = "ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ì´ë™â€¦";
  setTimeout(() => renderQuestion(run), 420);
}

btnResetAll.addEventListener("click", () => {
  if (!confirm("í”„ë¡œí•„/ì§„í–‰ì„ ì‚­ì œí•˜ê³  ì²˜ìŒë¶€í„° ì‹œì‘í• ê¹Œìš”?")) return;
  localStorage.removeItem(LS_PROFILE);
  localStorage.removeItem(LS_RUN);
  location.reload();
});

btnStart.addEventListener("click", () => {
  const nick = (nickEl.value || "").trim();
  const age = ageEl.value;
  const gender = genderEl.value;
  if (!nick || !age || !gender){ alert("ë‹‰ë„¤ì„/ë‚˜ì´/ì„±ë³„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”."); return; }
  saveJSON(LS_PROFILE, { nick, age, gender });
  hideStart();
  boot();
});
btnDemo.addEventListener("click", () => {
  saveJSON(LS_PROFILE, { nick: "ë°ëª¨ë¡ìŠ¤íƒ€", age: "20ëŒ€", gender: "ê¸°íƒ€" });
  hideStart();
  boot();
});

function boot(){
  const profile = loadJSON(LS_PROFILE, null);
  if (!profile){ showStart(); return; }
  applyProfile(profile);
  let run = loadRun();
  if (!run) run = initRun();
  renderQuestion(run);
}
boot();
</script>
</body>
</html>
