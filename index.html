<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ì˜¤ëŠ˜ì˜ì„ íƒ Â· ë½ìŠ¤íƒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì†Œë…€ (í”„ë¡œí† íƒ€ì…)</title>

  <style>
    :root{
      --safe-top: env(safe-area-inset-top);
      --safe-bot: env(safe-area-inset-bottom);

      --panel: rgba(10,14,25,0.80);
      --panel2: rgba(0,0,0,0.45);
      --border: rgba(255,255,255,0.14);
      --text: #f0f2ff;
      --muted: rgba(240,242,255,0.70);
      --muted2: rgba(240,242,255,0.55);
      --accent: rgba(255,60,95,0.90);
    }

    html, body { height: 100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: var(--text);
      height: 100svh;
      overflow: hidden;
      background: #05070f;
    }

    /* ====== ê²Œì„ ë£¨íŠ¸ ====== */
    #game{
      position: fixed;
      inset: 0;
      overflow: hidden;
    }

    /* ====== ë°°ê²½(ì„¸ë¡œ í’€ìŠ¤í¬ë¦°) ====== */
    .bg{
      position:absolute;
      inset:0;
      background: url("assets/bg/stage_vertical.png") center bottom / cover no-repeat;
      transform: scale(1.01);
      z-index:0;
    }
    .bg::after{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(900px 600px at 50% 20%, rgba(255,60,95,0.18), transparent 55%),
        linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.62));
    }

    /* ====== ìƒë‹¨ HUD ====== */
    .topHUD{
      position:absolute;
      top:0; left:0; right:0;
      padding: calc(12px + var(--safe-top)) 12px 10px;
      z-index: 30;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      pointer-events:none;
    }
    .brand{
      pointer-events:auto;
      font-weight: 950;
      letter-spacing: -0.2px;
      text-shadow: 0 10px 30px rgba(0,0,0,0.45);
      line-height: 1.05;
      font-size: 18px;
    }
    .brand .sub{
      font-size: 12px;
      color: var(--muted);
      font-weight: 700;
      margin-top: 4px;
    }
    .pill{
      pointer-events:auto;
      font-size:12px;
      padding:8px 10px;
      border:1px solid var(--border);
      border-radius: 999px;
      color: rgba(240,242,255,0.88);
      background: rgba(0,0,0,0.35);
      backdrop-filter: blur(6px);
      white-space: nowrap;
    }

    /* ====== ìºë¦­í„° ë¬´ëŒ€ ====== */
    .scene{
      position:absolute;
      inset:0;
      z-index:10;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      padding-bottom: calc(210px + var(--safe-bot)); /* í•˜ë‹¨ UI ê³µê°„ */
      pointer-events:none;
    }
    .doll{
      position: relative;
      width: min(92vw, 560px);
      aspect-ratio: 9 / 16;
      max-height: 74svh;
      filter: drop-shadow(0 30px 60px rgba(0,0,0,0.55));
    }

    .layer{
      position:absolute;
      left:0; top:0;
      width:100%;
      height:auto;
      user-select:none;
      -webkit-user-drag:none;
      pointer-events:none;
      will-change: transform;
    }

    /* ë ˆì´ì–´ ë°°ì¹˜(í•„ìš”í•˜ë©´ ì—¬ê¸° ìˆ«ìë§Œ ì¡°ì •) */
    /* bodyëŠ” ì¸í˜• ì „ì²´ í”„ë ˆì„ ê¸°ì¤€ìœ¼ë¡œ ì¤‘ì•™ */
    #bodyLayer{
      left: 6%;
      top: 6%;
      width: 88%;
      z-index: 1;
      transform-origin: 50% 70%;
    }

    /* ê¸°íƒ€(ëª¸ ìœ„ì— ì˜¬ë¼ê°€ê²Œ) */
    #guitarLayer{
      left: 16%;
      top: 37%;
      width: 78%;
      z-index: 2;
      transform-origin: 29% 50%; /* ë„¤ ë©”ëª¨ê°’ */
    }

    /* í”„ë ›(ì™¼ì†+ë„¥) */
    #fretArmLayer{
      left: 28%;
      top: 31%;
      width: 78%;
      z-index: 3;
      transform-origin: 20% 50%; /* ë„¤ ë©”ëª¨ê°’ */
    }

    /* í”¼í‚¹(ì˜¤ë¥¸ì†) */
    #pickArmLayer{
      left: 48%;
      top: 44%;
      width: 44%;
      z-index: 4;
      transform-origin: 34% 48%; /* ë„¤ ë©”ëª¨ê°’ */
    }

    /* ====== ê°„ë‹¨ ì• ë‹ˆë©”ì´ì…˜ ====== */
    @keyframes idleBreath {
      0%,100% { transform: translateY(0px) scale(1); }
      50%     { transform: translateY(-2px) scale(1.01); }
    }
    @keyframes strumOnce {
      0%   { transform: rotate(0deg) translateY(0px); }
      30%  { transform: rotate(-10deg) translateY(1px); }
      65%  { transform: rotate(8deg) translateY(-1px); }
      100% { transform: rotate(0deg) translateY(0px); }
    }
    @keyframes fretNudge {
      0%   { transform: rotate(0deg) translateX(0px); }
      50%  { transform: rotate(-2deg) translateX(-1px); }
      100% { transform: rotate(0deg) translateX(0px); }
    }

    .idle { animation: idleBreath 3.0s ease-in-out infinite; }
    .strum { animation: strumOnce 220ms ease-out 1; }
    .fret { animation: fretNudge 260ms ease-out 1; }

    /* ====== í•˜ë‹¨ UI íŒ¨ë„ ====== */
    .ui{
      position:absolute;
      left:0; right:0; bottom:0;
      z-index: 20;
      padding: 12px 12px calc(12px + var(--safe-bot));
    }

    .panel{
      border: 1px solid var(--border);
      border-radius: 18px;
      background: var(--panel);
      backdrop-filter: blur(10px);
      box-shadow: 0 30px 80px rgba(0,0,0,0.50);
      overflow:hidden;
    }

    .hudRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.12);
      font-size: 12px;
      color: var(--muted);
    }

    .progress{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 170px;
    }
    .bar{
      flex: 1;
      height: 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      overflow:hidden;
    }
    .bar > div{
      height: 100%;
      width: 0%;
      background: rgba(255,255,255,0.78);
    }

    .content{
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      max-height: min(44svh, 420px);
    }

    .q{
      font-size: 18px;
      font-weight: 950;
      letter-spacing: -0.2px;
      margin:0;
    }
    .desc{
      margin:0;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.35;
    }

    .choices{
      display:grid;
      gap: 10px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      padding-right: 2px;
    }

    button.choice{
      text-align:left;
      padding: 14px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      font-size: 16px;
    }
    button.choice:active{ transform: translateY(1px); }

    .row{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      padding-top: 2px;
    }
    button.ghost{
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.14);
      background: transparent;
      color: rgba(240,242,255,0.86);
      font-size: 13px;
    }

    /* ë¡œê·¸(í•˜ë‹¨ì—ì„œ ìœ„ë¡œ í¼ì¹¨) */
    .log{
      display:none;
      border-top: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
      padding: 10px 14px 14px;
      max-height: 34svh;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }
    .log h3{
      margin: 0 0 8px 0;
      font-size: 13px;
      color: rgba(240,242,255,0.88);
    }
    .item{
      padding: 8px 0;
      border-top: 1px solid rgba(255,255,255,0.08);
      font-size: 13px;
      color: rgba(240,242,255,0.92);
    }
    .item .t{ color: var(--muted2); font-size: 12px; }
    .item .q2{ color: var(--muted); font-size: 12px; margin-top: 3px; }

    /* ===== ì‹œì‘ í™”ë©´ ===== */
    #startScreen{
      position: fixed;
      inset: 0;
      z-index: 9999;
      display:none;
    }
    #startScreen .backdrop{
      position:absolute;
      inset:0;
      background: rgba(0,0,0,0.78);
    }
    #startScreen .panelWrap{
      position:relative;
      height: 100svh;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      padding: calc(14px + var(--safe-top)) 12px calc(14px + var(--safe-bot));
      box-sizing:border-box;
    }
    #startScreen .card{
      width:100%;
      max-width: 560px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(10,14,25,0.94);
      padding: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.45);
    }
    .title{
      font-weight: 950;
      font-size: 18px;
      margin:0 0 6px 0;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .subtitle{
      font-size: 13px;
      color: var(--muted);
      line-height: 1.35;
      margin: 0 0 12px 0;
    }
    .field{ margin: 10px 0; }
    .field label{
      display:block;
      font-size: 12px;
      color: rgba(240,242,255,0.75);
      margin-bottom: 6px;
    }
    .field input, .field select{
      width:100%;
      box-sizing:border-box;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      font-size: 15px;
      outline: none;
    }
    .startBtns{
      display:flex;
      gap: 10px;
      margin-top: 12px;
    }
    .primary{
      flex: 1;
      padding: 13px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,60,95,0.18);
      color: var(--text);
      font-weight: 950;
      font-size: 15px;
    }
    .secondary{
      padding: 13px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.14);
      background: transparent;
      color: rgba(240,242,255,0.86);
      font-weight: 900;
      font-size: 15px;
      white-space: nowrap;
    }
    .warn{
      margin-top: 8px;
      font-size: 12px;
      color: rgba(240,242,255,0.62);
    }
  </style>
</head>

<body>
  <!-- ì‹œì‘ í™”ë©´ -->
  <div id="startScreen">
    <div class="backdrop"></div>
    <div class="panelWrap">
      <div class="card">
        <p class="title">ğŸ¸ ìºë¦­í„° ìƒì„±</p>
        <p class="subtitle">
          ë½ìŠ¤íƒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì†Œë…€ì˜ ì„ íƒí˜• RPG.<br>
          ë‹‰ë„¤ì„/ë‚˜ì´/ì„±ë³„ì„ ì •í•˜ë©´ ë°”ë¡œ ì‹œì‘ë©ë‹ˆë‹¤. (ì„œë²„ ì—†ìŒ Â· ì´ ê¸°ê¸°ì—ë§Œ ì €ì¥)
        </p>

        <div class="field">
          <label for="nick">ë‹‰ë„¤ì„</label>
          <input id="nick" maxlength="12" />
        </div>

        <div class="field">
          <label for="age">ë‚˜ì´</label>
          <select id="age">
            <option value="">ì„ íƒ</option>
            <option>10ëŒ€</option><option>20ëŒ€</option><option>30ëŒ€</option><option>40ëŒ€</option><option>50ëŒ€+</option>
          </select>
        </div>

        <div class="field">
          <label for="gender">ì„±ë³„</label>
          <select id="gender">
            <option value="">ì„ íƒ</option>
            <option value="ë‚¨">ë‚¨</option>
            <option value="ì—¬">ì—¬</option>
            <option value="ê¸°íƒ€">ê¸°íƒ€/ë¹„ê³µê°œ</option>
          </select>
        </div>

        <div class="startBtns">
          <button class="primary" id="btnStart">ì‹œì‘í•˜ê¸°</button>
          <button class="secondary" id="btnDemo">ë°ëª¨</button>
        </div>

        <div class="warn">
          â€» ë‹‰ë„¤ì„/ì„±ë³„/ë‚˜ì´ëŠ” ì™¸ë¶€ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
        </div>
      </div>
    </div>
  </div>

  <div id="game">
    <div class="bg"></div>

    <div class="topHUD">
      <div class="brand">
        ğŸ¸ ì˜¤ëŠ˜ì˜ì„ íƒ Â· ë½ìŠ¤íƒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì†Œë…€
        <div class="sub">í”„ë¡œí† íƒ€ì… Â· ì„ íƒì´ ëˆ„ì ë˜ëŠ” ê²Œì„</div>
      </div>
      <div class="pill" id="userPill">ë¡œë”©ì¤‘â€¦</div>
    </div>

    <div class="scene">
      <div class="doll idle" id="doll">
        <!-- íŒŒì¼ëª…/ê²½ë¡œëŠ” ì—¬ê¸°ì„œë§Œ ê´€ë¦¬ -->
        <img id="bodyLayer"    class="layer" alt="body"   />
        <img id="guitarLayer"  class="layer" alt="guitar" />
        <img id="fretArmLayer" class="layer" alt="fret"   />
        <img id="pickArmLayer" class="layer" alt="pick"   />
      </div>
    </div>

    <div class="ui">
      <div class="panel">
        <div class="hudRow">
          <div class="progress">
            <span id="qIndexText">Q 1/15</span>
            <div class="bar"><div id="barFill"></div></div>
          </div>
          <div id="statusText">ì„ íƒí•˜ë©´ ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.</div>
        </div>

        <div class="content">
          <p class="q" id="questionText">ë¡œë”©ì¤‘â€¦</p>
          <p class="desc" id="questionDesc"></p>

          <div class="choices" id="choices"></div>

          <div class="row">
            <button class="ghost" id="btnToggleLog">ë‚´ ê¸°ë¡</button>
            <button class="ghost" id="btnResetRun">ì§„í–‰ ì´ˆê¸°í™”</button>
            <button class="ghost" id="btnResetAll">ì „ë¶€ ì‚­ì œ</button>
          </div>
        </div>

        <div class="log" id="logPanel">
          <h3>ë‚´ ê¸°ë¡ (ì´ ê¸°ê¸°ì—ë§Œ ì €ì¥)</h3>
          <div id="logBody"></div>
        </div>
      </div>
    </div>
  </div>

<script>
/** =========================
 *  ì—ì…‹ ê²½ë¡œ(ì—¬ê¸°ë§Œ ë§ì¶”ë©´ ë¨)
 *  ========================= */
const ASSET = {
  body:     "assets/character/rockstar_body.png",
  guitar:   "assets/character/rockstar_guitar.png",
  fretArm:  "assets/character/rockstar_fret_arm.png",
  pickArm:  "assets/character/rockstar_pick_arm.png"
};

/** =========================
 *  ë¡œì»¬ ì €ì¥ í‚¤
 *  ========================= */
const LS_PROFILE = "mychoice_profile_v2";
const LS_RUN     = "mychoice_run_v2";
const LS_LOG     = "mychoice_log_v2";

/** =========================
 *  ì§ˆë¬¸(15ê°œ) - ì „ë¬¸ì  + ì¬ë°Œê²Œ
 *  ========================= */
const QUESTIONS = [
  { q:"ì˜¤ëŠ˜ ê¸°íƒ€ë¥¼ ì§‘ì–´ë“œëŠ” ì´ìœ ëŠ”?", desc:"ì‹œì‘ì˜ ë™ê¸°ëŠ” ë§¤ë²ˆ ë‹¤ë¥´ì§€ë§Œ, ë°©í–¥ì€ ëˆ„ì ëœë‹¤.",
    options:["ì§€ê¸ˆ ì¹˜ì§€ ì•Šìœ¼ë©´ ì•ˆ ë  ê²ƒ ê°™ì•„ì„œ","ë£¨í‹´ì´ë‹ˆê¹Œ ìì—°ìŠ¤ëŸ½ê²Œ","ë¨¸ë¦¿ì†ì´ ì‹œë„ëŸ¬ì›Œì„œ","ì‚¬ì‹¤â€¦ ì˜¤ëŠ˜ì€ ë§ì„¤ì´ê³  ìˆë‹¤"] },

  { q:"ì—°ìŠµì„ ì‹œì‘í•  ë•Œ ê°€ì¥ ë¨¼ì € í•˜ëŠ” í–‰ë™ì€?", desc:"ì²« 5ë¶„ì€ í•˜ë£¨ì˜ ì§ˆì„ ê²°ì •í•œë‹¤.",
    options:["í¬ë¡œë§¤í‹±/ìŠ¤íŠ¸ë ˆì¹­ìœ¼ë¡œ ì†ì„ í‘¼ë‹¤","ì–´ì œ ì¹˜ë‹¤ ë§Œ í”„ë ˆì´ì¦ˆë¶€í„° ì´ì–´ê°„ë‹¤","ì¢‹ì•„í•˜ëŠ” ê³¡ì„ í•œ ë²ˆ í¬ê²Œ ì¹œë‹¤","ìœ íŠœë¸Œ/ë ˆìŠ¨ ì˜ìƒì„ ì¼ ë‹¤"] },

  { q:"í…œí¬ê°€ ì•ˆ ë§ì„ ë•Œ ë„ˆì˜ ì„ íƒì€?", desc:"ì†ë„ëŠ” ì‹¤ë ¥ì´ ì•„ë‹ˆë¼ ê²°ê³¼ë‹¤.",
    options:["ë©”íŠ¸ë¡œë†ˆ ì¼œê³  ì ˆë°˜ ì†ë„ë¡œ ìª¼ê° ë‹¤","ëŠë‚Œì´ ì˜¬ ë•Œê¹Œì§€ ë°˜ë³µí•œë‹¤","ë‹¤ë¥¸ íŒŒíŠ¸ë¡œ ë„˜ì–´ê°„ë‹¤","ì˜¤ëŠ˜ì€ ì´ ê³¡ì„ í¬ê¸°í•œë‹¤"] },

  { q:"â€˜ì—°ìŠµì´ ì˜ ëœë‹¤â€™ê³  ëŠë¼ëŠ” ê¸°ì¤€ì€?", desc:"ê¸°ë¶„ì´ ì•„ë‹ˆë¼ ì¸¡ì • ê°€ëŠ¥í•´ì•¼ ì„±ì¥í•œë‹¤.",
    options:["ì–´ì œë³´ë‹¤ ëª…í™•íˆ ì¢‹ì•„ì§„ ê²Œ ë“¤ë¦°ë‹¤","ëê¹Œì§€ ëŠê¸°ì§€ ì•ŠëŠ”ë‹¤","ì‹¤ìˆ˜í•´ë„ íšŒë³µì´ ë¹ ë¥´ë‹¤","ë­”ê°€ ë©‹ìˆê²Œ ëŠê»´ì§€ë©´ ì„±ê³µ"] },

  { q:"ì§€ê¸ˆ ê°€ì¥ ì•½í•œ ìš”ì†ŒëŠ” ë­ì•¼?", desc:"ì•½ì ì„ ë§ë¡œ ê³ ë¥´ë©´, ì—°ìŠµì´ ë°©í–¥ì„ ê°€ì§„ë‹¤.",
    options:["ë¦¬ë“¬/ê·¸ë£¨ë¸Œ","í”¼í‚¹ ì •í™•ë„","ì½”ë“œ ì „í™˜/í´ë¦°í†¤","í‘œí˜„ë ¥(ë‰˜ì•™ìŠ¤, ë‹¤ì´ë‚´ë¯¹)"] },

  { q:"ê¸°íƒ€ í†¤ì´ ë§ˆìŒì— ì•ˆ ë“¤ ë•Œ, ì²« ì ê²€ì€?", desc:"ì¥ë¹„ë³´ë‹¤ â€˜ì‹ í˜¸ íë¦„â€™ì´ ë¨¼ì €ë‹¤.",
    options:["ë³¼ë¥¨/í†¤/í”½ì—… í¬ì§€ì…˜ë¶€í„°","ì•°í”„ EQë¥¼ ê·¹ë‹¨ìœ¼ë¡œ ëŒë ¤ ê¸°ì¤€ ì°¾ê¸°","ì¼€ì´ë¸”/ë…¸ì´ì¦ˆ/ì ‘ì´‰ë¶€í„° í™•ì¸","ê²°êµ­ ì¥ë¹„ íƒ“ì´ë¼ ìƒê°í•œë‹¤"] },

  { q:"ì—°ìŠµ ë£¨í‹´ì„ ì§ ë‹¤ë©´ ê°€ì¥ ë¨¼ì € ë„£ëŠ” ê±´?", desc:"ê¸°ìˆ ì€ ë£¨í‹´ì—ì„œ ìë€ë‹¤.",
    options:["ì›Œë°ì—… + í¬ë¡œë§¤í‹±","ë¦¬ë“¬ í›ˆë ¨(ë©”íŠ¸ë¡œë†ˆ/ìŠ¤íŠ¸ëŸ¼ íŒ¨í„´)","ë ˆí¼í† ë¦¬(ê³¡ ì™„ì£¼)","ì¦‰í¥/í”„ë ˆì´ì¦ˆ ë§Œë“¤ê¸°"] },

  { q:"ë…¹ìŒ/ì´¬ì˜ì„ í•˜ë©´ ì–´ë–¤ ë°©ì‹ì´ í¸í•´?", desc:"ê¸°ë¡ì€ ì”í˜¹í•˜ì§€ë§Œ, ê°€ì¥ ê³µì •í•˜ë‹¤.",
    options:["ì§§ê²Œ ë§¤ì¼(30ì´ˆë¼ë„)","ì£¼ 1íšŒ ì œëŒ€ë¡œ ì„¸íŒ…í•´ì„œ","ê°€ë” ìƒê°ë‚  ë•Œë§Œ","ë¶€ë„ëŸ¬ì›Œì„œ ì•ˆ í•œë‹¤"] },

  { q:"í•©ì£¼/ë°´ë“œ ì œì•ˆì´ ì™”ë‹¤. ë„ˆì˜ ì„ íƒì€?", desc:"ì‹¤ì „ì€ ì‹¤ë ¥ì„ ë‹¹ê²¨ì˜¨ë‹¤.",
    options:["ì¼ë‹¨ í•œë‹¤. ë¶€ì¡±í•˜ë©´ ì±„ìš°ë©´ ë¨","ì¡°ê±´(ê³¡/ìŠ¤ì¼€ì¤„) ë§ìœ¼ë©´","ì‹¤ë ¥ ë” ìŒ“ê³  ë‚˜ì¤‘ì—","ì‚¬ëŒ ë§ì¶”ëŠ” ê²Œ í”¼ê³¤í•˜ë‹¤"] },

  { q:"ê´€ê°ì´ ìˆë‹¤ëŠ” ìƒìƒì„ í•˜ë©´ ë­ê°€ ì œì¼ ë¬´ì„­ë‚˜?", desc:"ê³µí¬ë¥¼ ì–¸ì–´ë¡œ ë°”ê¾¸ë©´, ëŒ€ì²˜ê°€ ìƒê¸´ë‹¤.",
    options:["ì‹¤ìˆ˜í• ê¹Œ ë´","í‘œì •/ìì„¸ê°€ ì–´ìƒ‰í• ê¹Œ ë´","í†¤ì´ ë³„ë¡œì¼ê¹Œ ë´","ë‚´ê°€ ë³„ë¡œì¼ê¹Œ ë´"] },

  { q:"ì†”ë¡œê°€ ê¹¨ë—í•˜ê²Œ ì•ˆ ë‚˜ì˜¬ ë•Œ, ë„ˆëŠ”?", desc:"â€˜ëŠë‚Œâ€™ì€ ì„¸ë¶€ ì¡°ì‘ì—ì„œ ë‚˜ì˜¨ë‹¤.",
    options:["í”¼í‚¹ ê°ë„/í˜ë¶€í„° ê³ ì¹œë‹¤","ì™¼ì† ì••ë ¥/ë®¤íŠ¸ë¶€í„°","ë©”íŠ¸ë¡œë†ˆ + êµ¬ê°„ ë°˜ë³µ","ì¼ë‹¨ ì†ë„ë¡œ ë°€ì–´ë¶™ì¸ë‹¤"] },

  { q:"ê³¡ì„ ë§Œë“ ë‹¤ë©´ ì²« ì¶œë°œì ì€?", desc:"ì°½ì‘ì€ â€˜ì‹œì‘ì  ì„ íƒâ€™ì´ ë°˜ì´ë‹¤.",
    options:["ë¦¬í”„(ì†ì´ ë¨¼ì €)","ë©œë¡œë””(í¥ì–¼ê±°ë¦¼)","ê°€ì‚¬/ê°ì •(ìŠ¤í† ë¦¬)","ë ˆí¼ëŸ°ìŠ¤ êµ¬ì¡° ë¶„ì„"] },

  { q:"ì˜¤ëŠ˜ â€˜ê³µë¶€â€™ì— ì“¸ ìˆ˜ ìˆëŠ” ì‹œê°„ì€?", desc:"ì‹œê°„ì€ í˜„ì‹¤ì´ê³ , ì„ íƒì€ ì „ëµì´ë‹¤.",
    options:["10ë¶„(í•˜ì§€ë§Œ í™•ì‹¤íˆ)","30ë¶„(ë£¨í‹´ ê°€ëŠ¥)","1ì‹œê°„(ì§‘ì¤‘ ê°€ëŠ¥)","ì˜¤ëŠ˜ì€ ì—†ë‹¤(íšŒë³µì´ ë¨¼ì €)"] },

  { q:"ìŠ¬ëŸ¼í”„ê°€ ì˜¤ë©´ ë„ˆëŠ” ì–´ë–¤ íƒ€ì…?", desc:"ìŠ¬ëŸ¼í”„ëŠ” ê³ ì¥ì´ ì•„ë‹ˆë¼ ì‹ í˜¸ë‹¤.",
    options:["ê¸°ìˆ ì„ ë” íŒŒê³ ë“¤ë©° ë²„í‹´ë‹¤","ê³¡ì„ ë°”ê¿”ì„œ ì¬ë¯¸ë¥¼ ì°¾ëŠ”ë‹¤","ì‰¬ê³  ë‹¤ì‹œ ì‹œì‘í•œë‹¤","ìì±…í•˜ë‹¤ê°€ ë©ˆì¶˜ë‹¤"] },

  { q:"ë§ˆì§€ë§‰. ì˜¤ëŠ˜ì˜ ë„ˆëŠ” í•œ ê±¸ìŒì´ì—ˆë‚˜?", desc:"ì„±ì¥ì€ â€˜ì™„ë²½â€™ì´ ì•„ë‹ˆë¼ â€˜ëˆ„ì â€™ì´ë‹¤.",
    options:["ì‘. í–‰ë™í–ˆë‹¤.","ë°˜ë°˜. ê·¸ë˜ë„ í–ˆë‹¤.","ì•„ë‹ˆ. í•˜ì§€ë§Œ ë‚´ì¼ì€ ë‹¤ë¥´ê²Œ.","ëª¨ë¥´ê² ë‹¤. ê·¸ë˜ë„ ê¸°íƒ€ëŠ” ë†“ì§€ ì•Šê² ë‹¤."] },
];

/** =========================
 *  DOM
 *  ========================= */
const startScreen = document.getElementById("startScreen");
const nickEl = document.getElementById("nick");
const ageEl = document.getElementById("age");
const genderEl = document.getElementById("gender");
const btnStart = document.getElementById("btnStart");
const btnDemo = document.getElementById("btnDemo");

const userPill = document.getElementById("userPill");

const doll = document.getElementById("doll");
const bodyLayer = document.getElementById("bodyLayer");
const guitarLayer = document.getElementById("guitarLayer");
const fretArmLayer = document.getElementById("fretArmLayer");
const pickArmLayer = document.getElementById("pickArmLayer");

const qIndexText = document.getElementById("qIndexText");
const barFill = document.getElementById("barFill");
const statusText = document.getElementById("statusText");
const questionText = document.getElementById("questionText");
const questionDesc = document.getElementById("questionDesc");
const choices = document.getElementById("choices");

const btnToggleLog = document.getElementById("btnToggleLog");
const btnResetRun = document.getElementById("btnResetRun");
const btnResetAll = document.getElementById("btnResetAll");
const logPanel = document.getElementById("logPanel");
const logBody = document.getElementById("logBody");

/** =========================
 *  ìœ í‹¸
 *  ========================= */
function nowKST(){
  return new Date().toLocaleString("ko-KR");
}
function loadJSON(key, fallback){
  try { return JSON.parse(localStorage.getItem(key) || ""); }
  catch { return fallback; }
}
function saveJSON(key, value){
  localStorage.setItem(key, JSON.stringify(value));
}
function escapeHTML(s){
  return String(s)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/** =========================
 *  í”„ë¡œí•„
 *  ========================= */
function loadProfile(){ return loadJSON(LS_PROFILE, null); }
function saveProfile(profile){ saveJSON(LS_PROFILE, profile); }
function applyProfile(profile){
  const nick = profile?.nick || "í”Œë ˆì´ì–´";
  const age = profile?.age || "";
  const gender = profile?.gender || "";
  userPill.textContent = `${nick}${age ? " Â· "+age : ""}${gender ? " Â· "+gender : ""}`;
}

/** =========================
 *  ì§„í–‰ ìƒíƒœ
 *  ========================= */
function initRun(){
  const run = { idx: 0, answers: [] };
  saveJSON(LS_RUN, run);
  return run;
}
function loadRun(){ return loadJSON(LS_RUN, null); }
function saveRun(run){ saveJSON(LS_RUN, run); }

/** =========================
 *  ë¡œê·¸
 *  ========================= */
function addLog(entry){
  const logs = loadJSON(LS_LOG, []);
  logs.unshift(entry);
  saveJSON(LS_LOG, logs);
}
function renderLog(){
  const logs = loadJSON(LS_LOG, []);
  if (logs.length === 0){
    logBody.innerHTML = `<div class="item"><div class="t">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div></div>`;
    return;
  }
  logBody.innerHTML = logs.slice(0, 60).map(l => `
    <div class="item">
      <div class="t">[${escapeHTML(l.time)}]</div>
      <div><b>${escapeHTML(l.answer)}</b></div>
      <div class="q2">${escapeHTML(l.question)}</div>
    </div>
  `).join("");
}

/** =========================
 *  ìºë¦­í„° ë¡œë“œ + ì˜¤ë¥˜ í™•ì¸
 *  ========================= */
function bindImg(imgEl, src){
  imgEl.src = src;
  imgEl.onerror = () => {
    console.error("ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:", src);
    // iOSì—ì„œ ê¹¨ì¡Œì„ ë•Œ í‹° ë‚˜ê²Œ
    imgEl.style.opacity = "0.15";
  };
}
function loadCharacterAssets(){
  bindImg(bodyLayer, ASSET.body);
  bindImg(guitarLayer, ASSET.guitar);
  bindImg(fretArmLayer, ASSET.fretArm);
  bindImg(pickArmLayer, ASSET.pickArm);
}

/** =========================
 *  ëª¨ì…˜
 *  ========================= */
function strumOnce(){
  pickArmLayer.classList.remove("strum");
  // reflow
  void pickArmLayer.offsetWidth;
  pickArmLayer.classList.add("strum");

  fretArmLayer.classList.remove("fret");
  void fretArmLayer.offsetWidth;
  fretArmLayer.classList.add("fret");
}

/** =========================
 *  ì§ˆë¬¸ ë Œë”ë§
 *  ========================= */
function renderQuestion(run){
  const total = QUESTIONS.length;
  const idx = run.idx;

  if (idx >= total){
    renderEnding(run);
    return;
  }

  const q = QUESTIONS[idx];

  qIndexText.textContent = `Q ${idx+1}/${total}`;
  barFill.style.width = `${Math.round((idx / total) * 100)}%`;

  questionText.textContent = q.q;
  questionDesc.textContent = q.desc;

  choices.innerHTML = "";
  q.options.forEach((opt, i) => {
    const b = document.createElement("button");
    b.className = "choice";
    b.textContent = `${["A","B","C","D"][i]}. ${opt}`;
    b.onclick = () => onChoose(run, opt);
    choices.appendChild(b);
  });

  statusText.textContent = "ì„ íƒí•˜ë©´ ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.";
}

function onChoose(run, answer){
  const idx = run.idx;
  const q = QUESTIONS[idx];

  // ëª¨ì…˜
  strumOnce();

  // ì €ì¥
  run.answers.push({ question: q.q, answer, at: new Date().toISOString() });
  addLog({ time: nowKST(), question: q.q, answer });

  run.idx += 1;
  saveRun(run);
  renderLog();

  statusText.textContent = "ê¸°ë¡ ì™„ë£Œ. ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ì´ë™â€¦";
  setTimeout(() => renderQuestion(run), 260);
}

function renderEnding(run){
  const total = QUESTIONS.length;
  barFill.style.width = "100%";
  qIndexText.textContent = `END Â· ${total}/${total}`;

  const nick = loadProfile()?.nick || "í”Œë ˆì´ì–´";
  questionText.textContent = `${nick}ì˜ ì˜¤ëŠ˜ì€ ì €ì¥ëë‹¤.`;
  questionDesc.textContent = "ì´ê±´ ëì´ ì•„ë‹ˆë¼ ëˆ„ì ì˜ ì‹œì‘ì´ë‹¤. ë‚´ì¼ ë˜ ì„ íƒí•˜ë©´ ë„ˆëŠ” ë¶„ëª… ë‹¬ë¼ì§„ë‹¤.";

  choices.innerHTML = `
    <button class="choice" id="btnRestart">ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°</button>
    <button class="choice" id="btnToggleLog2">ë‚´ ê¸°ë¡ ë³´ê¸°/ë‹«ê¸°</button>
  `;

  document.getElementById("btnRestart").onclick = () => {
    if (confirm("ì§„í–‰(15ë¬¸í•­)ì„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ í• ê¹Œìš”? (ê¸°ë¡ ë¡œê·¸ëŠ” ìœ ì§€)")){
      const newRun = initRun();
      renderQuestion(newRun);
    }
  };
  document.getElementById("btnToggleLog2").onclick = toggleLog;

  statusText.textContent = "ì—”ë”©. ë‹¤ì‹œí•˜ê¸° ë˜ëŠ” ê¸°ë¡ í™•ì¸.";
}

/** =========================
 *  ë²„íŠ¼
 *  ========================= */
function toggleLog(){
  const isHidden = getComputedStyle(logPanel).display === "none";
  logPanel.style.display = isHidden ? "block" : "none";
}
function resetRun(){
  if (!confirm("ì§„í–‰ìƒí™©(ë¬¸í•­)ì„ ì´ˆê¸°í™”í• ê¹Œìš”? (ê¸°ë¡ ë¡œê·¸ëŠ” ìœ ì§€)")) return;
  initRun();
  const run = loadRun();
  renderQuestion(run);
}
function resetAll(){
  if (!confirm("í”„ë¡œí•„/ì§„í–‰/ê¸°ë¡ì„ ì „ë¶€ ì‚­ì œí•˜ê³  ì²˜ìŒë¶€í„° ì‹œì‘í• ê¹Œìš”?")) return;
  localStorage.removeItem(LS_PROFILE);
  localStorage.removeItem(LS_RUN);
  localStorage.removeItem(LS_LOG);
  location.reload();
}

btnToggleLog.addEventListener("click", toggleLog);
btnResetRun.addEventListener("click", resetRun);
btnResetAll.addEventListener("click", resetAll);

/** =========================
 *  ì‹œì‘ í™”ë©´ íë¦„
 *  ========================= */
function showStart(){ startScreen.style.display = "block"; }
function hideStart(){ startScreen.style.display = "none"; }

btnStart.addEventListener("click", () => {
  const nick = (nickEl.value || "").trim();
  const age = ageEl.value;
  const gender = genderEl.value;

  if (!nick || !age || !gender){
    alert("ë‹‰ë„¤ì„/ë‚˜ì´/ì„±ë³„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
    return;
  }
  saveProfile({ nick, age, gender });
  hideStart();
  boot();
});

btnDemo.addEventListener("click", () => {
  saveProfile({ nick: "ë°ëª¨ë¡ìŠ¤íƒ€", age: "20ëŒ€", gender: "ê¸°íƒ€" });
  hideStart();
  boot();
});

/** =========================
 *  ë¶€íŒ…
 *  ========================= */
function boot(){
  loadCharacterAssets();

  const profile = loadProfile();
  if (!profile){
    showStart();
    return;
  }
  applyProfile(profile);

  let run = loadRun();
  if (!run) run = initRun();

  renderLog();
  renderQuestion(run);
}

boot();
</script>
</body>
</html>
