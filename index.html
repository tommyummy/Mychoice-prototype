<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ì˜¤ëŠ˜ì˜ì„ íƒ Â· ë½ìŠ¤íƒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì†Œë…€ (í”„ë¡œí† íƒ€ì…)</title>

  <style>
    :root{
      --safe-top: env(safe-area-inset-top);
      --safe-bot: env(safe-area-inset-bottom);
      --bg: #0b0f1a;
      --panel: rgba(255,255,255,0.06);
      --panel2: rgba(0,0,0,0.35);
      --border: rgba(255,255,255,0.12);
      --text: #f0f2ff;
      --muted: rgba(240,242,255,0.70);
      --muted2: rgba(240,242,255,0.55);
      --accent: rgba(255,60,95,0.85);
    }

    html, body { height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100svh;
      overflow:hidden;
    }

    .wrap{
      max-width: 560px;
      margin: 0 auto;
      height: 100svh;
      padding: calc(12px + var(--safe-top)) 12px calc(12px + var(--safe-bot));
      box-sizing:border-box;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .brand{
      font-weight: 900;
      letter-spacing: 0.2px;
      display:flex; align-items:center; gap:8px;
      font-size: 16px;
    }
    .pill{
      font-size:12px;
      padding:6px 10px;
      border:1px solid var(--border);
      border-radius: 999px;
      color: var(--muted);
      background: rgba(255,255,255,0.03);
      white-space: nowrap;
    }

    .stage{
      height: calc(100svh - (12px + var(--safe-top) + 12px + var(--safe-bot) + 34px));
      border: 1px solid var(--border);
      border-radius: 18px;
      overflow: hidden;
      background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.02));
      display:flex;
      flex-direction: column;
    }

    /* ===== ìºë¦­í„°(í’€ì‚¬ì´ì¦ˆ ëŠë‚Œ) ì˜ì—­ ===== */
    .hero{
      position: relative;
      padding: 12px;
      border-bottom: 1px solid var(--border);
      background: rgba(0,0,0,0.18);
    }

    .heroCard{
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.22);
      border-radius: 16px;
      padding: 12px;
      display:grid;
      gap: 10px;
    }

    .heroTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .meta .name{
      font-weight: 950;
      font-size: 16px;
    }
    .meta .role{
      font-size: 12px;
      color: var(--muted);
      margin-top:4px;
    }
    .accent-dot{
      width:10px; height:10px; border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 18px rgba(255,60,95,0.55);
      display:inline-block;
      margin-left: 6px;
      vertical-align: middle;
    }

    /* ===== ë ˆì´ì–´ ìºë¦­í„° ìŠ¤í…Œì´ì§€ ===== */
    .characterStage{
      position: relative;
      width: 100%;
      aspect-ratio: 3 / 4; /* ì„¸ë¡œ í’€ì‚¬ì´ì¦ˆ ëŠë‚Œ */
      border-radius: 14px;
      overflow:hidden;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.10);
    }

    .character{
      position:absolute;
      inset:0;
      display:block;
    }

    .layer{
      position:absolute;
      left:0; top:0;
      width:100%;
      height:100%;
      object-fit: contain;
      pointer-events:none;
      user-select:none;
      -webkit-user-drag:none;
      image-rendering: auto;
    }

    /* ìˆ¨ì‰¬ê¸°(ì „ì²´) */
    @keyframes idleBreath {
      0%,100% { transform: translateY(0px) scale(1); }
      50%     { transform: translateY(-2px) scale(1.01); }
    }
    .character.is-idle{
      animation: idleBreath 2.8s ease-in-out infinite;
      transform-origin: 50% 85%;
    }

    /* ===== íŒ” ì• ë‹ˆë©”ì´ì…˜ ===== */
    /* ì—¬ê¸° 2ê°œê°€ ì œì¼ ì¤‘ìš”: ì´ë¯¸ì§€ì— ë§ê²Œ ìˆ«ìë§Œ ì¡°ì ˆí•˜ë©´ ë¨ */
    .fret{
      transform-origin: 22% 32%; /* ì™¼íŒ” ì–´ê¹¨(ëŒ€ì¶©) */
    }
    .pick{
      transform-origin: 30% 34%; /* ì˜¤ë¥¸íŒ” ì–´ê¹¨(ëŒ€ì¶©) */
    }

    @keyframes fretMove {
      0%,100% { transform: rotate(0deg) translateX(0px); }
      50%     { transform: rotate(1.5deg) translateX(1px); }
    }
    .fret.playing{
      animation: fretMove 0.55s ease-in-out infinite;
    }

    @keyframes strum {
      0%   { transform: rotate(10deg) translateY(0); }
      50%  { transform: rotate(-8deg) translateY(6px); }
      100% { transform: rotate(10deg) translateY(0); }
    }
    .pick.playing{
      animation: strum 0.18s ease-in-out infinite;
    }

    /* ì„ íƒ ëˆŒë €ì„ ë•Œ â€œê°•í•˜ê²Œ í•œ ë²ˆâ€ */
    @keyframes hitOnce {
      0%   { transform: rotate(12deg) translateY(0) scale(1); }
      55%  { transform: rotate(-12deg) translateY(9px) scale(1.01); }
      100% { transform: rotate(10deg) translateY(0) scale(1); }
    }
    .pick.hit{
      animation: hitOnce 0.28s ease-out 1;
    }

    /* ===== ëŒ€í™”/ì„ íƒ ===== */
    .dialogue{
      flex: 1;
      display:flex;
      flex-direction: column;
      gap: 10px;
      padding: 12px;
      background: var(--panel2);
      overflow:hidden;
    }

    .hud{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      font-size:12px;
      color: var(--muted);
    }
    .progress{
      display:flex;
      align-items:center;
      gap: 8px;
    }
    .bar{
      width: 120px;
      height: 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: rgba(255,255,255,0.75);
    }

    .box{
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 14px;
      padding: 14px;
      background: rgba(255,255,255,0.05);
      box-shadow: 0 12px 30px rgba(0,0,0,0.25);
      overflow:hidden;
    }
    .question{
      margin:0 0 10px 0;
      font-size: 18px;
      font-weight: 950;
      letter-spacing: -0.2px;
    }
    .desc{
      margin: 0 0 12px 0;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.35;
    }

    .choices{
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      padding-bottom: 6px;
      display:grid;
      gap: 10px;
    }
    button.choice{
      text-align:left;
      padding: 14px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      font-size: 16px;
    }
    button.choice:active{ transform: translateY(1px); }

    .row{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      margin-top: 12px;
    }
    button.ghost{
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.14);
      background: transparent;
      color: rgba(240,242,255,0.85);
      font-size: 13px;
    }

    /* ì‹œì‘ í™”ë©´ */
    #startScreen{
      position: fixed;
      inset: 0;
      z-index: 9999;
      display:none;
    }
    #startScreen .backdrop{
      position:absolute;
      inset:0;
      background: rgba(0,0,0,0.75);
    }
    #startScreen .panelWrap{
      position:relative;
      height: 100svh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: calc(18px + var(--safe-top)) 16px calc(18px + var(--safe-bot));
      box-sizing:border-box;
    }
    #startScreen .panel{
      width:100%;
      max-width: 520px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(10,14,25,0.94);
      padding: 18px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.45);
    }
    .title{
      font-weight: 950;
      font-size: 18px;
      margin-bottom: 6px;
      display:flex; align-items:center; gap:8px;
    }
    .subtitle{
      font-size: 13px;
      color: var(--muted);
      line-height: 1.35;
      margin-bottom: 14px;
    }
    .field{ margin: 12px 0; }
    .field label{
      display:block;
      font-size: 12px;
      color: rgba(240,242,255,0.75);
      margin-bottom: 6px;
    }
    .field input, .field select{
      width:100%;
      box-sizing:border-box;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      font-size: 15px;
      outline: none;
    }

    .startBtns{
      display:flex;
      gap: 10px;
      margin-top: 14px;
    }
    .primary{
      flex: 1;
      padding: 13px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,60,95,0.18);
      color: var(--text);
      font-weight: 900;
      font-size: 15px;
    }
    .secondary{
      padding: 13px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.14);
      background: transparent;
      color: rgba(240,242,255,0.85);
      font-weight: 800;
      font-size: 15px;
      white-space: nowrap;
    }

    /* ë°ìŠ¤í¬íƒ‘ì—ì„œëŠ” ìŠ¤í¬ë¡¤ */
    @media (min-width: 900px){
      body{ overflow:auto; height:auto; }
      .wrap{ max-width: 860px; height:auto; padding: 16px; }
      .stage{ height:auto; }
    }
  </style>
</head>

<body>
  <!-- ì‹œì‘ í™”ë©´ -->
  <div id="startScreen">
    <div class="backdrop"></div>
    <div class="panelWrap">
      <div class="panel">
        <div class="title">ğŸ¸ ìºë¦­í„° ìƒì„± <span class="accent-dot"></span></div>
        <div class="subtitle">
          ë‹‰ë„¤ì„/ë‚˜ì´/ì„±ë³„ì„ ì •í•˜ë©´ ì‹œì‘ë©ë‹ˆë‹¤. (ì„œë²„ ì—†ìŒ Â· ì´ ê¸°ê¸°ì—ë§Œ ì €ì¥)
        </div>

        <div class="field">
          <label for="nick">ë‹‰ë„¤ì„</label>
          <input id="nick" maxlength="12" />
        </div>

        <div class="field">
          <label for="age">ë‚˜ì´</label>
          <select id="age">
            <option value="">ì„ íƒ</option>
            <option>10ëŒ€</option><option>20ëŒ€</option><option>30ëŒ€</option><option>40ëŒ€</option><option>50ëŒ€+</option>
          </select>
        </div>

        <div class="field">
          <label for="gender">ì„±ë³„</label>
          <select id="gender">
            <option value="">ì„ íƒ</option>
            <option value="ë‚¨">ë‚¨</option>
            <option value="ì—¬">ì—¬</option>
            <option value="ê¸°íƒ€">ê¸°íƒ€/ë¹„ê³µê°œ</option>
          </select>
        </div>

        <div class="startBtns">
          <button class="primary" id="btnStart">ì‹œì‘í•˜ê¸°</button>
          <button class="secondary" id="btnDemo">ë°ëª¨ë¡œ</button>
        </div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="topbar">
      <div class="brand">ğŸ¸ ì˜¤ëŠ˜ì˜ì„ íƒ Â· ë½ìŠ¤íƒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì†Œë…€ (í”„ë¡œí† íƒ€ì…)</div>
      <div class="pill" id="userPill">ë¡œë”©ì¤‘â€¦</div>
    </div>

    <div class="stage">

      <!-- ìºë¦­í„° í’€ì‚¬ì´ì¦ˆ -->
      <div class="hero">
        <div class="heroCard">
          <div class="heroTop">
            <div class="meta">
              <div class="name" id="playerName">í”Œë ˆì´ì–´</div>
              <div class="role" id="playerRole">ë½ìŠ¤íƒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì†Œë…€ <span class="accent-dot"></span></div>
            </div>
            <button class="ghost" id="btnPlayToggle">ì—°ì£¼ ON/OFF</button>
          </div>

          <div class="characterStage">
            <div class="character is-idle" id="character">
              <img class="layer body"  src="assets/character/body.png"     alt="">
              <img class="layer guitar" src="assets/character/guitar.png"   alt="">
              <img class="layer arm fret" id="fretArm" src="assets/character/fret_arm.png" alt="">
              <img class="layer arm pick" id="pickArm" src="assets/character/pick_arm.png" alt="">
            </div>
          </div>
        </div>
      </div>

      <!-- ì§ˆë¬¸ ì˜ì—­ -->
      <div class="dialogue">
        <div class="hud">
          <div class="progress">
            <span id="qIndexText">Q 1/10</span>
            <div class="bar"><div id="barFill"></div></div>
          </div>
          <div id="statusText">ì„ íƒí•˜ë©´ ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.</div>
        </div>

        <div class="box">
          <p class="question" id="questionText">ë¡œë”©ì¤‘â€¦</p>
          <p class="desc" id="questionDesc"></p>
          <div class="choices" id="choices"></div>

          <div class="row">
            <button class="ghost" id="btnResetAll">ì²˜ìŒë¶€í„° ë‹¤ì‹œ</button>
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
  const LS_PROFILE = "mychoice_profile_v1";
  const LS_RUN     = "mychoice_run_v1";

  const QUESTIONS = [
    { q:"ì˜¤ëŠ˜ ì—°ìŠµì„ ì–¸ì œ í• ë˜?", desc:"ë½ìŠ¤íƒ€ëŠ” íƒ€ì´ë°ì´ ì•„ë‹ˆë¼ â€˜ë£¨í‹´â€™ì„ ê°€ì§„ë‹¤.", options:["ì§€ê¸ˆ 10ë¶„ë§Œì´ë¼ë„ ë°”ë¡œ í•œë‹¤","ì €ë…ì— ê° ì¡ê³  1ì‹œê°„ í•œë‹¤","ë‚´ì¼ ì»¨ë””ì…˜ ì¢‹ì„ ë•Œ í•œë‹¤","ì•ˆ í•œë‹¤â€¦(í•˜ì§€ë§Œ ì£„ì±…ê°ì€ ìˆë‹¤)"] },
    { q:"ê¸°íƒ€ë¥¼ ì§‘ì–´ë“œëŠ” ì´ìœ ëŠ”?", desc:"ëª©í‘œê°€ ì„ ëª…í•˜ë©´ í”ë“¤ë ¤ë„ ë‹¤ì‹œ ëŒì•„ì˜¨ë‹¤.", options:["ë¬´ëŒ€ì—ì„œ í„°ëœ¨ë¦¬ê³  ì‹¶ì–´ì„œ","ìŠ¤íŠ¸ë ˆìŠ¤ í’€ë ¤ê³ ","ë©‹ìˆì–´ ë³´ì—¬ì„œ","ê·¸ëƒ¥â€¦ ìŠµê´€ì²˜ëŸ¼"] },
    { q:"ì—°ìŠµí•  ë•Œ ê°€ì¥ ë¨¼ì € í•˜ëŠ” ê±´?", desc:"ì´ˆë°˜ 5ë¶„ì´ ê·¸ë‚  í€„ë¦¬í‹°ë¥¼ ê²°ì •í•œë‹¤.", options:["ì›Œë°ì—…(í¬ë¡œë§¤í‹±/ìŠ¤íŠ¸ë ˆì¹­)","ì¢‹ì•„í•˜ëŠ” ê³¡ë¶€í„° ì³ì„œ í…ì…˜ ì˜¬ë¦¼","ìƒˆë¡œ ë°°ìš°ëŠ” í”„ë ˆì´ì¦ˆ íŒŒê³ ë“¦","ìœ íŠœë¸Œ ì¼œê³  â€˜ë³´ê³  ë”°ë¼í•˜ê¸°â€™"] },
    { q:"ê¸°ìˆ ì´ ë§‰í ë•Œ ë„ˆì˜ ì„ íƒì€?", desc:"ë§‰íˆëŠ” êµ¬ê°„ì´ ì‹¤ë ¥ì˜ ê´€ë¬¸ì´ë‹¤.", options:["ë©”íŠ¸ë¡œë†ˆ ì¼œê³  ëŠë¦¬ê²Œ ìª¼ê° ë‹¤","ì†í’€ë¦´ ë•Œê¹Œì§€ ë°˜ë³µí•œë‹¤","í¬ê¸°í•˜ê³  ë‹¤ë¥¸ ê±° í•œë‹¤","ê°•ì˜/ë ˆìŠ¨ ìë£Œë¥¼ ì°¾ëŠ”ë‹¤"] },
    { q:"ë…¹ìŒ/ì´¬ì˜ì„ í•œë‹¤ë©´?", desc:"ê¸°ë¡ì€ ì‹¤ë ¥ í–¥ìƒì˜ ì¹˜íŠ¸í‚¤ë‹¤.", options:["ì§§ê²Œë¼ë„ ë§¤ì¼ ê¸°ë¡í•œë‹¤","ì£¼ 1íšŒ ì œëŒ€ë¡œ ì°ëŠ”ë‹¤","ê°€ë” ìƒê°ë‚  ë•Œë§Œ","ë¶€ë„ëŸ¬ì›Œì„œ ì•ˆ í•œë‹¤"] },
    { q:"ë¬´ëŒ€(í˜¹ì€ ì‚¬ëŒ ì•) ê³µí¬ê°€ ì˜¨ë‹¤ë©´?", desc:"ë¬´ëŒ€ëŠ” ì—°ìŠµëŸ‰ì˜ ê±°ì§“ë§ì„ ëª» ë³¸ë‹¤.", options:["ì‘ê²Œë¼ë„ ì‚¬ëŒ ì•ì—ì„œ ìì£¼ í•´ë³¸ë‹¤","ì™„ë²½í•´ì§ˆ ë•Œê¹Œì§€ ìˆ¨ëŠ”ë‹¤","ì¹œêµ¬ 1ëª… ì•ì—ì„œë¶€í„° ì‹œì‘","ì•„ì˜ˆ ë¬´ëŒ€ëŠ” ë‚´ ê¸¸ì´ ì•„ë‹Œ ë“¯"] },
    { q:"ì¥ë¹„ ì—…ê·¸ë ˆì´ë“œ ìš•êµ¬ê°€ í­ë°œí–ˆë‹¤.", desc:"ì¥ë¹„ëŠ” ë„ì›€ì´ ë˜ì§€ë§Œ, ì‹¤ë ¥ì€ ë” ì§ì ‘ì ì´ë‹¤.", options:["ì§€ê¸ˆ ìˆëŠ” ê±¸ë¡œ í†¤ ì„¸íŒ…ë¶€í„° íŒŒë³¸ë‹¤","í•„ìš”í•œ ê²ƒë§Œ ë”± í•˜ë‚˜ ì‚°ë‹¤","ì¶©ë™êµ¬ë§¤ ê°„ë‹¤(í–‰ë³µì€ ì ê¹)","ë¦¬ë·°ë§Œ 3ì‹œê°„ ë³¸ë‹¤(ê·¸ë¦¬ê³  ì•ˆ ì‚°ë‹¤)"] },
    { q:"ë°´ë“œ(í˜¹ì€ í•©ì£¼) ì œì•ˆì´ ì™”ë‹¤.", desc:"í•©ì£¼ëŠ” ì‹¤ì „ì´ê³ , ì‹¤ì „ì€ ì„±ì¥ì´ë‹¤.", options:["ì¼ë‹¨ í•œë‹¤. ë¶€ì¡±í•˜ë©´ ì±„ìš°ë©´ ë¨","ì¡°ê±´(ê³¡/ìŠ¤ì¼€ì¤„) ë§ìœ¼ë©´ í•œë‹¤","ì‹¤ë ¥ ë” ìŒ“ê³  ë‚˜ì¤‘ì—","ì‚¬ëŒ ë§ì¶”ëŠ” ê²Œ ë” í”¼ê³¤í•¨â€¦"] },
    { q:"ê³¡ì„ ë§Œë“¤ ê¸°íšŒê°€ ìƒê²¼ë‹¤.", desc:"â€˜ë‚´ ìƒ‰â€™ì€ ê²°êµ­ ìŒ“ì¸ ì„ íƒì—ì„œ ë‚˜ì˜¨ë‹¤.", options:["ë¦¬í”„ë¶€í„° ë½‘ëŠ”ë‹¤(ì†ì´ ë¨¼ì €)","ê°ì •/ìŠ¤í† ë¦¬ë¶€í„° ì¡ëŠ”ë‹¤","ë ˆí¼ëŸ°ìŠ¤ ì¡°ì‚¬í•˜ê³  êµ¬ì¡°ë¥¼ ì§ ë‹¤","ì¦‰í¥ìœ¼ë¡œ ë…¹ìŒí•˜ê³  ê±°ê¸°ì„œ ë½‘ëŠ”ë‹¤"] },
    { q:"ë§ˆì§€ë§‰ ì§ˆë¬¸. ì˜¤ëŠ˜ì˜ ë„ˆëŠ” ë¡ìŠ¤íƒ€ì— ê°€ê¹Œì› ë‚˜?", desc:"ë‹µì€ ì´ë¯¸ ì•Œê³  ìˆë‹¤. ê·¸ë˜ë„ ê¸°ë¡í•´ë¼.", options:["ê°€ê¹Œì› ë‹¤. í–‰ë™í–ˆë‹¤.","ë°˜ë°˜. ë§ˆìŒì€ ìˆì—ˆê³  ì¡°ê¸ˆ í–ˆë‹¤.","ë©€ì—ˆë‹¤. í•˜ì§€ë§Œ ë‚´ì¼ì€ ë‹¤ë¥´ê²Œ.","ëª¨ë¥´ê² ë‹¤. ê·¸ë˜ë„ ê¸°íƒ€ëŠ” ë†“ì§€ ì•Šê² ë‹¤."] },
  ];

  // DOM
  const startScreen = document.getElementById("startScreen");
  const nickEl = document.getElementById("nick");
  const ageEl = document.getElementById("age");
  const genderEl = document.getElementById("gender");
  const btnStart = document.getElementById("btnStart");
  const btnDemo = document.getElementById("btnDemo");

  const userPill = document.getElementById("userPill");
  const playerName = document.getElementById("playerName");

  const qIndexText = document.getElementById("qIndexText");
  const barFill = document.getElementById("barFill");
  const statusText = document.getElementById("statusText");
  const questionText = document.getElementById("questionText");
  const questionDesc = document.getElementById("questionDesc");
  const choices = document.getElementById("choices");

  const btnResetAll = document.getElementById("btnResetAll");

  const character = document.getElementById("character");
  const fretArm = document.getElementById("fretArm");
  const pickArm = document.getElementById("pickArm");
  const btnPlayToggle = document.getElementById("btnPlayToggle");

  function loadJSON(key, fallback){
    try { return JSON.parse(localStorage.getItem(key) || ""); }
    catch { return fallback; }
  }
  function saveJSON(key, value){
    localStorage.setItem(key, JSON.stringify(value));
  }

  function showStart(){ startScreen.style.display = "block"; }
  function hideStart(){ startScreen.style.display = "none"; }

  function loadProfile(){ return loadJSON(LS_PROFILE, null); }
  function saveProfile(p){ saveJSON(LS_PROFILE, p); }

  function initRun(){
    const run = { idx: 0, answers: [] };
    saveJSON(LS_RUN, run);
    return run;
  }
  function loadRun(){ return loadJSON(LS_RUN, null); }
  function saveRun(run){ saveJSON(LS_RUN, run); }

  function applyProfile(p){
    const nick = p?.nick || "í”Œë ˆì´ì–´";
    const age = p?.age || "";
    const gender = p?.gender || "";
    playerName.textContent = nick;
    userPill.textContent = `${nick}${age ? " Â· "+age : ""}${gender ? " Â· "+gender : ""}`;
  }

  // ===== ì—°ì£¼ í† ê¸€/ì›ìƒ· =====
  let isPlaying = true;

  function setPlaying(on){
    isPlaying = on;
    if (on){
      fretArm.classList.add("playing");
      pickArm.classList.add("playing");
      btnPlayToggle.textContent = "ì—°ì£¼ ON/OFF";
    } else {
      fretArm.classList.remove("playing");
      pickArm.classList.remove("playing");
      btnPlayToggle.textContent = "ì—°ì£¼ ON/OFF";
    }
  }

  function hitOnce(){
    // ì„ íƒí•  ë•Œ í•œ ë²ˆ ê°•í•˜ê²Œ
    pickArm.classList.remove("hit");
    // reflow
    void pickArm.offsetWidth;
    pickArm.classList.add("hit");
    setTimeout(() => pickArm.classList.remove("hit"), 320);
  }

  btnPlayToggle.addEventListener("click", () => setPlaying(!isPlaying));

  // ===== ì§ˆë¬¸ =====
  function renderQuestion(run){
    const total = QUESTIONS.length;
    const idx = run.idx;

    if (idx >= total){
      qIndexText.textContent = `END Â· ${total}/${total}`;
      barFill.style.width = "100%";
      questionText.textContent = "ì˜¤ëŠ˜ ê¸°ë¡ ì™„ë£Œ.";
      questionDesc.textContent = "ë‚´ì¼ ë˜ ì„ íƒí•˜ë©´ ëˆ„ì ëœë‹¤.";
      choices.innerHTML = `<button class="choice" id="btnRestart">ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°</button>`;
      document.getElementById("btnRestart").onclick = () => {
        const newRun = initRun();
        renderQuestion(newRun);
      };
      statusText.textContent = "ë. ë‹¤ì‹œí•˜ê¸° ê°€ëŠ¥.";
      return;
    }

    const q = QUESTIONS[idx];
    qIndexText.textContent = `Q ${idx+1}/${total}`;
    barFill.style.width = `${Math.round(((idx) / total) * 100)}%`;

    questionText.textContent = q.q;
    questionDesc.textContent = q.desc;

    choices.innerHTML = "";
    q.options.forEach((opt, i) => {
      const b = document.createElement("button");
      b.className = "choice";
      b.textContent = `${["A","B","C","D"][i]}. ${opt}`;
      b.onclick = () => onChoose(run, opt);
      choices.appendChild(b);
    });

    statusText.textContent = "ì„ íƒí•˜ë©´ ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.";
  }

  function onChoose(run, answer){
    const idx = run.idx;
    const q = QUESTIONS[idx];

    // â€œê°•í•˜ê²Œ í•œ ë²ˆâ€
    hitOnce();

    run.answers.push({ question: q.q, answer, at: new Date().toISOString() });
    run.idx += 1;
    saveRun(run);

    statusText.textContent = "ê¸°ë¡ ì™„ë£Œ. ë‹¤ìŒ ì§ˆë¬¸â€¦";
    setTimeout(() => renderQuestion(run), 350);
  }

  function resetAll(){
    if (!confirm("í”„ë¡œí•„/ì§„í–‰ì„ ì‚­ì œí•˜ê³  ì²˜ìŒë¶€í„° ì‹œì‘í• ê¹Œìš”?")) return;
    localStorage.removeItem(LS_PROFILE);
    localStorage.removeItem(LS_RUN);
    location.reload();
  }
  btnResetAll.addEventListener("click", resetAll);

  // ===== ì‹œì‘ í”Œë¡œìš° =====
  btnStart.addEventListener("click", () => {
    const nick = (nickEl.value || "").trim();
    const age = ageEl.value;
    const gender = genderEl.value;
    if (!nick || !age || !gender){
      alert("ë‹‰ë„¤ì„/ë‚˜ì´/ì„±ë³„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }
    saveProfile({ nick, age, gender });
    hideStart();
    boot();
  });

  btnDemo.addEventListener("click", () => {
    saveProfile({ nick: "ë°ëª¨", age: "20ëŒ€", gender: "ê¸°íƒ€" });
    hideStart();
    boot();
  });

  function boot(){
    const profile = loadProfile();
    if (!profile){
      showStart();
      return;
    }
    applyProfile(profile);

    let run = loadRun();
    if (!run) run = initRun();

    // ê¸°ë³¸ì€ ì—°ì£¼ ON
    setPlaying(true);

    renderQuestion(run);
  }

  boot();
</script>
</body>
</html>
